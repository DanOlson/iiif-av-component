var IIIFAVComponent=function(t){var e={};function n(i){if(e[i])return e[i].exports;var r=e[i]={i:i,l:!1,exports:{}};return t[i].call(r.exports,r,r.exports,n),r.l=!0,r.exports}return n.m=t,n.c=e,n.d=function(t,e,i){n.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:i})},n.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},n.t=function(t,e){if(1&e&&(t=n(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var i=Object.create(null);if(n.r(i),Object.defineProperty(i,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var r in t)n.d(i,r,function(e){return t[e]}.bind(null,r));return i},n.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return n.d(e,"a",e),e},n.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},n.p="",n(n.s=26)}([function(t,e,n){"undefined"!=typeof self&&self,t.exports=function(t){var e={};function n(i){if(e[i])return e[i].exports;var r=e[i]={i:i,l:!1,exports:{}};return t[i].call(r.exports,r,r.exports,n),r.l=!0,r.exports}return n.m=t,n.c=e,n.d=function(t,e,i){n.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:i})},n.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},n.t=function(t,e){if(1&e&&(t=n(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var i=Object.create(null);if(n.r(i),Object.defineProperty(i,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var r in t)n.d(i,r,function(e){return t[e]}.bind(null,r));return i},n.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return n.d(e,"a",e),e},n.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},n.p="",n(n.s=4)}([function(t,e,n){"use strict";function i(t){for(var n in t)e.hasOwnProperty(n)||(e[n]=t[n])}Object.defineProperty(e,"__esModule",{value:!0}),i(n(6)),i(n(7)),i(n(8)),i(n(9)),i(n(10)),i(n(11)),i(n(12)),i(n(13)),i(n(14)),i(n(15)),i(n(16)),i(n(17)),i(n(18)),i(n(19)),i(n(20)),i(n(21)),i(n(22)),i(n(23)),i(n(24)),i(n(25)),i(n(26)),i(n(27)),i(n(28)),i(n(29)),i(n(30)),i(n(31)),i(n(32)),i(n(2))},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),function(t){t.BOOKMARKING="oa:bookmarking",t.CLASSIFYING="oa:classifying",t.COMMENTING="oa:commenting",t.DESCRIBING="oa:describing",t.EDITING="oa:editing",t.HIGHLIGHTING="oa:highlighting",t.IDENTIFYING="oa:identifying",t.LINKING="oa:linking",t.MODERATING="oa:moderating",t.PAINTING="sc:painting",t.QUESTIONING="oa:questioning",t.REPLYING="oa:replying",t.TAGGING="oa:tagging",t.TRANSCRIBING="oad:transcribing"}(e.AnnotationMotivation||(e.AnnotationMotivation={})),function(t){t.AUTO_ADVANCE="auto-advance",t.CONTINUOUS="continuous",t.FACING_PAGES="facing-pages",t.HIDDEN="hidden",t.INDIVIDUALS="individuals",t.MULTI_PART="multi-part",t.NO_NAV="no-nav",t.NON_PAGED="non-paged",t.PAGED="paged",t.REPEAT="repeat",t.SEQUENCE="sequence",t.THUMBNAIL_NAV="thumbnail-nav",t.TOGETHER="together",t.UNORDERED="unordered"}(e.Behavior||(e.Behavior={})),function(t){t.CANVAS="canvas",t.CHOICE="choice",t.CONTENT_AS_TEXT="contentastext",t.DOCUMENT="document",t.IMAGE="image",t.MOVING_IMAGE="movingimage",t.PDF="pdf",t.PHYSICAL_OBJECT="physicalobject",t.SOUND="sound",t.TEXTUALBODY="textualbody",t.VIDEO="video"}(e.ExternalResourceType||(e.ExternalResourceType={})),function(t){t.ANNOTATION="annotation",t.CANVAS="canvas",t.COLLECTION="collection",t.MANIFEST="manifest",t.RANGE="range",t.SEQUENCE="sequence"}(e.IIIFResourceType||(e.IIIFResourceType={})),function(t){t.AUDIO_MP4="audio/mp4",t.CORTO="application/corto",t.DRACO="application/draco",t.GLTF="model/gltf+json",t.JPG="image/jpeg",t.M3U8="application/vnd.apple.mpegurl",t.MP3="audio/mp3",t.MPEG_DASH="application/dash+xml",t.OBJ="text/plain",t.PDF="application/pdf",t.PLY="application/ply",t.THREEJS="application/vnd.threejs+json",t.VIDEO_MP4="video/mp4",t.WEBM="video/webm"}(e.MediaType||(e.MediaType={})),function(t){t.DOC="application/msword",t.DOCX="application/vnd.openxmlformats-officedocument.wordprocessingml.document",t.PDF="application/pdf"}(e.RenderingFormat||(e.RenderingFormat={})),function(t){t.IMAGE_0_COMPLIANCE_LEVEL_0="http://library.stanford.edu/iiif/image-api/compliance.html#level0",t.IMAGE_0_COMPLIANCE_LEVEL_1="http://library.stanford.edu/iiif/image-api/compliance.html#level1",t.IMAGE_0_COMPLIANCE_LEVEL_2="http://library.stanford.edu/iiif/image-api/compliance.html#level2",t.IMAGE_0_CONFORMANCE_LEVEL_0="http://library.stanford.edu/iiif/image-api/conformance.html#level0",t.IMAGE_0_CONFORMANCE_LEVEL_1="http://library.stanford.edu/iiif/image-api/conformance.html#level1",t.IMAGE_0_CONFORMANCE_LEVEL_2="http://library.stanford.edu/iiif/image-api/conformance.html#level2",t.IMAGE_1_COMPLIANCE_LEVEL_0="http://library.stanford.edu/iiif/image-api/1.1/compliance.html#level0",t.IMAGE_1_COMPLIANCE_LEVEL_1="http://library.stanford.edu/iiif/image-api/1.1/compliance.html#level1",t.IMAGE_1_COMPLIANCE_LEVEL_2="http://library.stanford.edu/iiif/image-api/1.1/compliance.html#level2",t.IMAGE_1_CONFORMANCE_LEVEL_0="http://library.stanford.edu/iiif/image-api/1.1/conformance.html#level0",t.IMAGE_1_CONFORMANCE_LEVEL_1="http://library.stanford.edu/iiif/image-api/1.1/conformance.html#level1",t.IMAGE_1_CONFORMANCE_LEVEL_2="http://library.stanford.edu/iiif/image-api/1.1/conformance.html#level2",t.IMAGE_1_LEVEL_0="http://iiif.io/api/image/1/level0.json",t.IMAGE_1_PROFILE_LEVEL_0="http://iiif.io/api/image/1/profiles/level0.json",t.IMAGE_1_LEVEL_1="http://iiif.io/api/image/1/level1.json",t.IMAGE_1_PROFILE_LEVEL_1="http://iiif.io/api/image/1/profiles/level1.json",t.IMAGE_1_LEVEL_2="http://iiif.io/api/image/1/level2.json",t.IMAGE_1_PROFILE_LEVEL_2="http://iiif.io/api/image/1/profiles/level2.json",t.IMAGE_2_LEVEL_0="http://iiif.io/api/image/2/level0.json",t.IMAGE_2_PROFILE_LEVEL_0="http://iiif.io/api/image/2/profiles/level0.json",t.IMAGE_2_LEVEL_1="http://iiif.io/api/image/2/level1.json",t.IMAGE_2_PROFILE_LEVEL_1="http://iiif.io/api/image/2/profiles/level1.json",t.IMAGE_2_LEVEL_2="http://iiif.io/api/image/2/level2.json",t.IMAGE_2_PROFILE_LEVEL_2="http://iiif.io/api/image/2/profiles/level2.json",t.AUTH_0_CLICK_THROUGH="http://iiif.io/api/auth/0/login/clickthrough",t.AUTH_0_LOGIN="http://iiif.io/api/auth/0/login",t.AUTH_0_LOGOUT="http://iiif.io/api/auth/0/logout",t.AUTH_0_RESTRICTED="http://iiif.io/api/auth/0/login/restricted",t.AUTH_0_TOKEN="http://iiif.io/api/auth/0/token",t.AUTH_1_CLICK_THROUGH="http://iiif.io/api/auth/1/clickthrough",t.AUTH_1_EXTERNAL="http://iiif.io/api/auth/1/external",t.AUTH_1_KIOSK="http://iiif.io/api/auth/1/kiosk",t.AUTH_1_LOGIN="http://iiif.io/api/auth/1/login",t.AUTH_1_LOGOUT="http://iiif.io/api/auth/1/logout",t.AUTH_1_PROBE="http://iiif.io/api/auth/1/probe",t.AUTH_1_TOKEN="http://iiif.io/api/auth/1/token",t.SEARCH_0="http://iiif.io/api/search/0/search",t.SEARCH_0_AUTO_COMPLETE="http://iiif.io/api/search/0/autocomplete",t.SEARCH_1="http://iiif.io/api/search/1/search",t.SEARCH_1_AUTO_COMPLETE="http://iiif.io/api/search/1/autocomplete",t.TRACKING_EXTENSIONS="http://universalviewer.io/tracking-extensions-profile",t.UI_EXTENSIONS="http://universalviewer.io/ui-extensions-profile",t.PRINT_EXTENSIONS="http://universalviewer.io/print-extensions-profile",t.SHARE_EXTENSIONS="http://universalviewer.io/share-extensions-profile",t.OTHER_MANIFESTATIONS="http://iiif.io/api/otherManifestations.json",t.IXIF="http://wellcomelibrary.org/ld/ixif/0/alpha.json"}(e.ServiceProfile||(e.ServiceProfile={})),function(t){t.BOTTOM_TO_TOP="bottom-to-top",t.LEFT_TO_RIGHT="left-to-right",t.RIGHT_TO_LEFT="right-to-left",t.TOP_TO_BOTTOM="top-to-bottom"}(e.ViewingDirection||(e.ViewingDirection={})),function(t){t.CONTINUOUS="continuous",t.INDIVIDUALS="individuals",t.NON_PAGED="non-paged",t.PAGED="paged",t.TOP="top"}(e.ViewingHint||(e.ViewingHint={}))},function(t,e,n){"use strict";var i=this&&this.__awaiter||function(t,e,n,i){return new(n||(n=Promise))((function(r,a){function o(t){try{u(i.next(t))}catch(t){a(t)}}function s(t){try{u(i.throw(t))}catch(t){a(t)}}function u(t){var e;t.done?r(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(o,s)}u((i=i.apply(t,e||[])).next())}))},r=this&&this.__generator||function(t,e){var n,i,r,a,o={label:0,sent:function(){if(1&r[0])throw r[1];return r[1]},trys:[],ops:[]};return a={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a;function s(a){return function(s){return function(a){if(n)throw new TypeError("Generator is already executing.");for(;o;)try{if(n=1,i&&(r=2&a[0]?i.return:a[0]?i.throw||((r=i.return)&&r.call(i),0):i.next)&&!(r=r.call(i,a[1])).done)return r;switch(i=0,r&&(a=[2&a[0],r.value]),a[0]){case 0:case 1:r=a;break;case 4:return o.label++,{value:a[1],done:!1};case 5:o.label++,i=a[1],a=[0];continue;case 7:a=o.ops.pop(),o.trys.pop();continue;default:if(!(r=(r=o.trys).length>0&&r[r.length-1])&&(6===a[0]||2===a[0])){o=0;continue}if(3===a[0]&&(!r||a[1]>r[0]&&a[1]<r[3])){o.label=a[1];break}if(6===a[0]&&o.label<r[1]){o.label=r[1],r=a;break}if(r&&o.label<r[2]){o.label=r[2],o.ops.push(a);break}r[2]&&o.ops.pop(),o.trys.pop();continue}a=e.call(t,o)}catch(t){a=[6,t],i=0}finally{n=r=0}if(5&a[0])throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}([a,s])}}};Object.defineProperty(e,"__esModule",{value:!0});var a=n(0),o=n(1),s=n(33);n(34);var u=function(){function t(){}return t.getMediaType=function(t){return(t=(t=t.toLowerCase()).split(";")[0]).trim()},t.getImageQuality=function(t){return t===o.ServiceProfile.IMAGE_0_COMPLIANCE_LEVEL_1||t===o.ServiceProfile.IMAGE_0_COMPLIANCE_LEVEL_2||t===o.ServiceProfile.IMAGE_1_COMPLIANCE_LEVEL_1||t===o.ServiceProfile.IMAGE_1_COMPLIANCE_LEVEL_2||t===o.ServiceProfile.IMAGE_0_CONFORMANCE_LEVEL_1||t===o.ServiceProfile.IMAGE_0_CONFORMANCE_LEVEL_2||t===o.ServiceProfile.IMAGE_1_CONFORMANCE_LEVEL_1||t===o.ServiceProfile.IMAGE_1_CONFORMANCE_LEVEL_2||t===o.ServiceProfile.IMAGE_1_LEVEL_1||t===o.ServiceProfile.IMAGE_1_PROFILE_LEVEL_1||t===o.ServiceProfile.IMAGE_1_LEVEL_2||t===o.ServiceProfile.IMAGE_1_PROFILE_LEVEL_2?"native":"default"},t.getInexactLocale=function(t){return-1!==t.indexOf("-")?t.substr(0,t.indexOf("-")):t},t.getLocalisedValue=function(t,e){if(!Array.isArray(t))return t;for(var n=0;n<t.length;n++){var i=t[n];if(e===i["@language"])return i["@value"]}var r=e.substr(0,e.indexOf("-"));for(n=0;n<t.length;n++){var a=t[n];if(a["@language"]===r)return a["@value"]}return null},t.generateTreeNodeIds=function(e,n){var i;void 0===n&&(n=0),i=e.parentNode?e.parentNode.id+"-"+n:"0",e.id=i;for(var r=0;r<e.nodes.length;r++){var a=e.nodes[r];t.generateTreeNodeIds(a,r)}},t.normaliseType=function(t){return-1!==(t=t.toLowerCase()).indexOf(":")?t.split(":")[1]:t},t.normaliseUrl=function(t){return-1!==(t=t.substr(t.indexOf("://"))).indexOf("#")&&(t=t.split("#")[0]),t},t.normalisedUrlsMatch=function(e,n){return t.normaliseUrl(e)===t.normaliseUrl(n)},t.isImageProfile=function(e){return!!(t.normalisedUrlsMatch(e,o.ServiceProfile.IMAGE_0_COMPLIANCE_LEVEL_0)||t.normalisedUrlsMatch(e,o.ServiceProfile.IMAGE_0_COMPLIANCE_LEVEL_1)||t.normalisedUrlsMatch(e,o.ServiceProfile.IMAGE_0_COMPLIANCE_LEVEL_2)||t.normalisedUrlsMatch(e,o.ServiceProfile.IMAGE_1_COMPLIANCE_LEVEL_0)||t.normalisedUrlsMatch(e,o.ServiceProfile.IMAGE_1_COMPLIANCE_LEVEL_2)||t.normalisedUrlsMatch(e,o.ServiceProfile.IMAGE_0_CONFORMANCE_LEVEL_0)||t.normalisedUrlsMatch(e,o.ServiceProfile.IMAGE_0_CONFORMANCE_LEVEL_1)||t.normalisedUrlsMatch(e,o.ServiceProfile.IMAGE_0_CONFORMANCE_LEVEL_2)||t.normalisedUrlsMatch(e,o.ServiceProfile.IMAGE_1_CONFORMANCE_LEVEL_1)||t.normalisedUrlsMatch(e,o.ServiceProfile.IMAGE_1_CONFORMANCE_LEVEL_2)||t.normalisedUrlsMatch(e,o.ServiceProfile.IMAGE_1_LEVEL_0)||t.normalisedUrlsMatch(e,o.ServiceProfile.IMAGE_1_PROFILE_LEVEL_0)||t.normalisedUrlsMatch(e,o.ServiceProfile.IMAGE_1_LEVEL_1)||t.normalisedUrlsMatch(e,o.ServiceProfile.IMAGE_1_PROFILE_LEVEL_1)||t.normalisedUrlsMatch(e,o.ServiceProfile.IMAGE_1_LEVEL_2)||t.normalisedUrlsMatch(e,o.ServiceProfile.IMAGE_1_PROFILE_LEVEL_2)||t.normalisedUrlsMatch(e,o.ServiceProfile.IMAGE_2_LEVEL_0)||t.normalisedUrlsMatch(e,o.ServiceProfile.IMAGE_2_PROFILE_LEVEL_0)||t.normalisedUrlsMatch(e,o.ServiceProfile.IMAGE_2_LEVEL_1)||t.normalisedUrlsMatch(e,o.ServiceProfile.IMAGE_2_PROFILE_LEVEL_1)||t.normalisedUrlsMatch(e,o.ServiceProfile.IMAGE_2_LEVEL_2)||t.normalisedUrlsMatch(e,o.ServiceProfile.IMAGE_2_PROFILE_LEVEL_2))},t.isLevel0ImageProfile=function(e){return!!(t.normalisedUrlsMatch(e,o.ServiceProfile.IMAGE_0_COMPLIANCE_LEVEL_0)||t.normalisedUrlsMatch(e,o.ServiceProfile.IMAGE_1_COMPLIANCE_LEVEL_0)||t.normalisedUrlsMatch(e,o.ServiceProfile.IMAGE_0_CONFORMANCE_LEVEL_0)||t.normalisedUrlsMatch(e,o.ServiceProfile.IMAGE_1_CONFORMANCE_LEVEL_0)||t.normalisedUrlsMatch(e,o.ServiceProfile.IMAGE_1_LEVEL_0)||t.normalisedUrlsMatch(e,o.ServiceProfile.IMAGE_1_PROFILE_LEVEL_0)||t.normalisedUrlsMatch(e,o.ServiceProfile.IMAGE_2_LEVEL_0)||t.normalisedUrlsMatch(e,o.ServiceProfile.IMAGE_2_PROFILE_LEVEL_0))},t.isLevel1ImageProfile=function(e){return!!(t.normalisedUrlsMatch(e,o.ServiceProfile.IMAGE_0_COMPLIANCE_LEVEL_1)||t.normalisedUrlsMatch(e,o.ServiceProfile.IMAGE_1_COMPLIANCE_LEVEL_1)||t.normalisedUrlsMatch(e,o.ServiceProfile.IMAGE_0_CONFORMANCE_LEVEL_1)||t.normalisedUrlsMatch(e,o.ServiceProfile.IMAGE_1_CONFORMANCE_LEVEL_1)||t.normalisedUrlsMatch(e,o.ServiceProfile.IMAGE_1_LEVEL_1)||t.normalisedUrlsMatch(e,o.ServiceProfile.IMAGE_1_PROFILE_LEVEL_1)||t.normalisedUrlsMatch(e,o.ServiceProfile.IMAGE_2_LEVEL_1)||t.normalisedUrlsMatch(e,o.ServiceProfile.IMAGE_2_PROFILE_LEVEL_1))},t.isLevel2ImageProfile=function(e){return!!(t.normalisedUrlsMatch(e,o.ServiceProfile.IMAGE_0_COMPLIANCE_LEVEL_2)||t.normalisedUrlsMatch(e,o.ServiceProfile.IMAGE_1_COMPLIANCE_LEVEL_2)||t.normalisedUrlsMatch(e,o.ServiceProfile.IMAGE_0_CONFORMANCE_LEVEL_2)||t.normalisedUrlsMatch(e,o.ServiceProfile.IMAGE_1_CONFORMANCE_LEVEL_2)||t.normalisedUrlsMatch(e,o.ServiceProfile.IMAGE_1_LEVEL_2)||t.normalisedUrlsMatch(e,o.ServiceProfile.IMAGE_1_PROFILE_LEVEL_2)||t.normalisedUrlsMatch(e,o.ServiceProfile.IMAGE_2_LEVEL_2)||t.normalisedUrlsMatch(e,o.ServiceProfile.IMAGE_2_PROFILE_LEVEL_2))},t.parseManifest=function(t,e){return a.Deserialiser.parse(t,e)},t.checkStatus=function(t){if(t.ok)return t;var e=new Error(t.statusText);return e.response=t,Promise.reject(e)},t.loadManifest=function(e){return new Promise((function(n){fetch(e).then(t.checkStatus).then((function(t){return t.json()})).then((function(t){n(t)}))}))},t.loadExternalResourcesAuth1=function(e,n,i,r,a,o,s,u){return new Promise((function(l,c){var h=e.map((function(e){return t.loadExternalResourceAuth1(e,n,i,r,a,o,s,u)}));Promise.all(h).then((function(){l(e)})).catch((function(t){c(t)}))}))},t.loadExternalResourceAuth1=function(e,n,a,o,u,l,c,h){return i(this,void 0,void 0,(function(){var i;return r(this,(function(r){switch(r.label){case 0:return[4,o(e)];case 1:return(i=r.sent())?[4,e.getData(i)]:[3,6];case 2:return r.sent(),e.status!==s.OK?[3,3]:[2,e];case 3:return[4,t.doAuthChain(e,n,a,u,l,c,h)];case 4:r.sent(),r.label=5;case 5:if(e.status===s.OK||e.status===s.MOVED_TEMPORARILY)return[2,e];throw t.createAuthorizationFailedError();case 6:return[4,e.getData()];case 7:return r.sent(),e.status!==s.MOVED_TEMPORARILY&&e.status!==s.UNAUTHORIZED?[3,9]:[4,t.doAuthChain(e,n,a,u,l,c,h)];case 8:r.sent(),r.label=9;case 9:if(e.status===s.OK||e.status===s.MOVED_TEMPORARILY)return[2,e];throw t.createAuthorizationFailedError()}}))}))},t.doAuthChain=function(e,n,a,o,u,l,c){return i(this,void 0,void 0,(function(){var i,h,p,f,d,v,_,g;return r(this,(function(r){switch(r.label){case 0:return e.isAccessControlled()?((i=e.externalService)&&(i.options=e.options),(h=e.kioskService)&&(h.options=e.options),(p=e.clickThroughService)&&(p.options=e.options),(f=e.loginService)&&(f.options=e.options),e.isResponseHandled||e.status!==s.MOVED_TEMPORARILY?[3,2]:[4,l(e)]):[2,e];case 1:return r.sent(),[2,e];case 2:return d=null,v=null,(d=i)?(v=d,[4,t.attemptResourceWithToken(e,a,d)]):[3,4];case 3:return r.sent(),[2,e];case 4:return(d=h)?(v=d,(_=n(d))?[4,o(_)]:[3,7]):[3,7];case 5:return r.sent(),[4,t.attemptResourceWithToken(e,a,d)];case 6:return r.sent(),[2,e];case 7:return(d=p)?(v=d,[4,u(e,d)]):[3,11];case 8:return(g=r.sent())?[4,o(g)]:[3,11];case 9:return r.sent(),[4,t.attemptResourceWithToken(e,a,d)];case 10:return r.sent(),[2,e];case 11:return(d=f)?(v=d,[4,u(e,d)]):[3,15];case 12:return(g=r.sent())?[4,o(g)]:[3,15];case 13:return r.sent(),[4,t.attemptResourceWithToken(e,a,d)];case 14:return r.sent(),[2,e];case 15:return v&&c(e,v),[2]}}))}))},t.attemptResourceWithToken=function(t,e,n){return i(this,void 0,void 0,(function(){var i,a;return r(this,(function(r){switch(r.label){case 0:return(i=n.getService(o.ServiceProfile.AUTH_1_TOKEN))?[4,e(t,i)]:[3,3];case 1:return(a=r.sent())&&a.accessToken?[4,t.getData(a)]:[3,3];case 2:return r.sent(),[2,t];case 3:return[2]}}))}))},t.loadExternalResourcesAuth09=function(e,n,i,r,a,o,s,u,l,c){return new Promise((function(h,p){var f=e.map((function(e){return t.loadExternalResourceAuth09(e,n,i,r,a,o,s,u,l,c)}));Promise.all(f).then((function(){h(e)})).catch((function(t){p(t)}))}))},t.loadExternalResourceAuth09=function(e,n,i,r,a,o,u,l,c,h){return new Promise((function(p,f){h&&h.pessimisticAccessControl?e.getData().then((function(){e.isAccessControlled()?e.clickThroughService?(p(i(e)),p(r(e))):a(e).then((function(){o(e,!0).then((function(n){e.getData(n).then((function(){p(c(e))})).catch((function(e){f(t.createInternalServerError(e))}))})).catch((function(e){f(t.createInternalServerError(e))}))})).catch((function(e){f(t.createInternalServerError(e))})):p(e)})).catch((function(e){f(t.createInternalServerError(e))})):l(e,n).then((function(h){h?e.getData(h).then((function(){e.status===s.OK?p(c(e)):t.authorize(e,n,i,r,a,o,u,l).then((function(){p(c(e))})).catch((function(e){f(t.createAuthorizationFailedError())}))})).catch((function(e){f(t.createAuthorizationFailedError())})):t.authorize(e,n,i,r,a,o,u,l).then((function(){p(c(e))})).catch((function(e){f(t.createAuthorizationFailedError())}))})).catch((function(e){f(t.createAuthorizationFailedError())}))}))},t.createError=function(t,e){var n=new Error;return n.message=e,n.name=String(t),n},t.createAuthorizationFailedError=function(){return t.createError(a.StatusCode.AUTHORIZATION_FAILED,"Authorization failed")},t.createRestrictedError=function(){return t.createError(a.StatusCode.RESTRICTED,"Restricted")},t.createInternalServerError=function(e){return t.createError(a.StatusCode.INTERNAL_SERVER_ERROR,e)},t.authorize=function(e,n,i,r,a,o,u,l){return new Promise((function(c,h){e.getData().then((function(){e.isAccessControlled()?l(e,n).then((function(l){l?e.getData(l).then((function(){e.status===s.OK?c(e):t.showAuthInteraction(e,n,i,r,a,o,u,c,h)})).catch((function(e){h(t.createInternalServerError(e))})):o(e,!1).then((function(l){l?u(e,l,n).then((function(){e.getData(l).then((function(){e.status===s.OK?c(e):t.showAuthInteraction(e,n,i,r,a,o,u,c,h)})).catch((function(e){h(t.createInternalServerError(e))}))})).catch((function(e){h(t.createInternalServerError(e))})):t.showAuthInteraction(e,n,i,r,a,o,u,c,h)}))})).catch((function(e){h(t.createInternalServerError(e))})):c(e)}))}))},t.showAuthInteraction=function(e,n,i,r,a,o,u,l,c){e.status!==s.MOVED_TEMPORARILY||e.isResponseHandled?e.clickThroughService&&!e.isResponseHandled?i(e).then((function(){o(e,!0).then((function(i){u(e,i,n).then((function(){e.getData(i).then((function(){l(e)})).catch((function(e){c(t.createInternalServerError(e))}))})).catch((function(e){c(t.createInternalServerError(e))}))})).catch((function(e){c(t.createInternalServerError(e))}))})):a(e).then((function(){o(e,!0).then((function(i){u(e,i,n).then((function(){e.getData(i).then((function(){l(e)})).catch((function(e){c(t.createInternalServerError(e))}))})).catch((function(e){c(t.createInternalServerError(e))}))})).catch((function(e){c(t.createInternalServerError(e))}))})):l(e)},t.getService=function(t,e){for(var n=this.getServices(t),i=0;i<n.length;i++){var r=n[i];if(r.getProfile()===e)return r}return null},t.getResourceById=function(e,n){return t.traverseAndFind(e.__jsonld,"@id",n)},t.traverseAndFind=function(e,n,i){if(e.hasOwnProperty(n)&&e[n]===i)return e;for(var r=0;r<Object.keys(e).length;r++)if("object"==typeof e[Object.keys(e)[r]]){var a=t.traverseAndFind(e[Object.keys(e)[r]],n,i);if(null!=a)return a}},t.getServices=function(t){var e,n=[];if(!(e=t.__jsonld?t.__jsonld.service:t.service))return n;Array.isArray(e)||(e=[e]);for(var i=0;i<e.length;i++){var r=e[i];if("string"==typeof r){var o=this.getResourceById(t.options.resource,r);o&&n.push(new a.Service(o.__jsonld||o,t.options))}else n.push(new a.Service(r,t.options))}return n},t.getTemporalComponent=function(t){var e=/t=([^&]+)/g.exec(t),n=null;return e&&e[1]&&(n=e[1].split(",")),n},t}();e.Utils=u},function(t,e,n){"use strict";n.r(e),e.default=function(t,e){return e=e||{},new Promise((function(n,i){var r=new XMLHttpRequest,a=[],o=[],s={},u=function(){return{ok:2==(r.status/100|0),statusText:r.statusText,status:r.status,url:r.responseURL,text:function(){return Promise.resolve(r.responseText)},json:function(){return Promise.resolve(JSON.parse(r.responseText))},blob:function(){return Promise.resolve(new Blob([r.response]))},clone:u,headers:{keys:function(){return a},entries:function(){return o},get:function(t){return s[t.toLowerCase()]},has:function(t){return t.toLowerCase()in s}}}};for(var l in r.open(e.method||"get",t,!0),r.onload=function(){r.getAllResponseHeaders().replace(/^(.*?):[^\S\n]*([\s\S]*?)$/gm,(function(t,e,n){a.push(e=e.toLowerCase()),o.push([e,n]),s[e]=s[e]?s[e]+","+n:n})),n(u())},r.onerror=i,r.withCredentials="include"==e.credentials,e.headers)r.setRequestHeader(l,e.headers[l]);r.send(e.body||null)}))}},function(t,e,n){t.exports=n(5)},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),function(t){for(var n in t)e.hasOwnProperty(n)||(e[n]=t[n])}(n(0));var i=n(2);e.loadManifest=function(t){return i.Utils.loadManifest(t)},e.parseManifest=function(t,e){return i.Utils.parseManifest(t,e)}},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=function(){function t(t){this.__jsonld=t,this.context=this.getProperty("context"),this.id=this.getProperty("id")}return t.prototype.getProperty=function(t){var e=null;return this.__jsonld&&((e=this.__jsonld[t])||(e=this.__jsonld["@"+t])),e},t}();e.JSONLDResource=i},function(t,e,n){"use strict";var i,r=this&&this.__extends||(i=function(t,e){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(t,e)},function(t,e){function n(){this.constructor=t}i(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)});Object.defineProperty(e,"__esModule",{value:!0});var a=n(0),o=n(1),s=function(t){function e(e,n){var i=t.call(this,e)||this;return i.options=n,i}return r(e,t),e.prototype.getIIIFResourceType=function(){return a.Utils.normaliseType(this.getProperty("type"))},e.prototype.getLabel=function(){var t=this.getProperty("label");return t?a.LanguageMap.parse(t,this.options.locale):[]},e.prototype.getDefaultLabel=function(){return a.LanguageMap.getValue(this.getLabel())},e.prototype.getMetadata=function(){var t=this.getProperty("metadata"),e=[];if(!t)return e;for(var n=0;n<t.length;n++){var i=t[n],r=new a.LabelValuePair(this.options.locale);r.parse(i),e.push(r)}return e},e.prototype.getRendering=function(t){for(var e=this.getRenderings(),n=0;n<e.length;n++){var i=e[n];if(i.getFormat()===t)return i}return null},e.prototype.getRenderings=function(){var t,e=[];if(!(t=this.__jsonld?this.__jsonld.rendering:this.rendering))return e;Array.isArray(t)||(t=[t]);for(var n=0;n<t.length;n++){var i=t[n];e.push(new a.Rendering(i,this.options))}return e},e.prototype.getService=function(t){return a.Utils.getService(this,t)},e.prototype.getServices=function(){return a.Utils.getServices(this)},e.prototype.getThumbnail=function(){var t=this.getProperty("thumbnail");return Array.isArray(t)&&(t=t[0]),t?new a.Thumbnail(t,this.options):null},e.prototype.isAnnotation=function(){return this.getIIIFResourceType()===o.IIIFResourceType.ANNOTATION},e.prototype.isCanvas=function(){return this.getIIIFResourceType()===o.IIIFResourceType.CANVAS},e.prototype.isCollection=function(){return this.getIIIFResourceType()===o.IIIFResourceType.COLLECTION},e.prototype.isManifest=function(){return this.getIIIFResourceType()===o.IIIFResourceType.MANIFEST},e.prototype.isRange=function(){return this.getIIIFResourceType()===o.IIIFResourceType.RANGE},e.prototype.isSequence=function(){return this.getIIIFResourceType()===o.IIIFResourceType.SEQUENCE},e}(a.JSONLDResource);e.ManifestResource=s},function(t,e,n){"use strict";var i,r=this&&this.__extends||(i=function(t,e){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(t,e)},function(t,e){function n(){this.constructor=t}i(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)});Object.defineProperty(e,"__esModule",{value:!0});var a=n(0),o=function(t){function e(e,n){return t.call(this,e,n)||this}return r(e,t),e.prototype.getFormat=function(){var t=this.getProperty("format");return t?t.toLowerCase():null},e.prototype.getResources=function(){var t=[];if(!this.__jsonld.resources)return t;for(var e=0;e<this.__jsonld.resources.length;e++){var n=this.__jsonld.resources[e],i=new a.Annotation(n,this.options);t.push(i)}return t},e.prototype.getType=function(){var t=this.getProperty("type");return t?a.Utils.normaliseType(t):null},e.prototype.getWidth=function(){return this.getProperty("width")},e.prototype.getHeight=function(){return this.getProperty("height")},e.prototype.getMaxWidth=function(){return this.getProperty("maxWidth")},e.prototype.getMaxHeight=function(){return this.getProperty("maxHeight")?null:this.getMaxWidth()},e}(a.ManifestResource);e.Resource=o},function(t,e,n){"use strict";var i,r=this&&this.__extends||(i=function(t,e){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(t,e)},function(t,e){function n(){this.constructor=t}i(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)});Object.defineProperty(e,"__esModule",{value:!0});var a=n(0),o=n(1),s=function(t){function e(e,n){var i=t.call(this,e,n)||this;i.index=-1,i.isLoaded=!1;var r={defaultLabel:"-",locale:"en-GB",resource:i,pessimisticAccessControl:!1};return i.options=Object.assign(r,n),i}return r(e,t),e.prototype.getAttribution=function(){var t=this.getProperty("attribution");return t?a.LanguageMap.parse(t,this.options.locale):[]},e.prototype.getDescription=function(){var t=this.getProperty("description");return t?a.LanguageMap.parse(t,this.options.locale):[]},e.prototype.getIIIFResourceType=function(){return a.Utils.normaliseType(this.getProperty("type"))},e.prototype.getLogo=function(){var t=this.getProperty("logo");return t?"string"==typeof t?t:(Array.isArray(t)&&t.length&&(t=t[0]),t["@id"]||t.id):null},e.prototype.getLicense=function(){return a.Utils.getLocalisedValue(this.getProperty("license"),this.options.locale)},e.prototype.getNavDate=function(){return new Date(this.getProperty("navDate"))},e.prototype.getRelated=function(){return this.getProperty("related")},e.prototype.getSeeAlso=function(){return this.getProperty("seeAlso")},e.prototype.getTrackingLabel=function(){var t=this.getService(o.ServiceProfile.TRACKING_EXTENSIONS);return t?t.getProperty("trackingLabel"):""},e.prototype.getDefaultTree=function(){return this.defaultTree=new a.TreeNode("root"),this.defaultTree.data=this,this.defaultTree},e.prototype.getRequiredStatement=function(){var t=null,e=this.getProperty("requiredStatement");if(e)(t=new a.LabelValuePair(this.options.locale)).parse(e);else{var n=this.getAttribution();n&&((t=new a.LabelValuePair(this.options.locale)).value=n)}return t},e.prototype.isCollection=function(){return this.getIIIFResourceType()===o.IIIFResourceType.COLLECTION},e.prototype.isManifest=function(){return this.getIIIFResourceType()===o.IIIFResourceType.MANIFEST},e.prototype.load=function(){var t=this;return new Promise((function(e){if(t.isLoaded)e(t);else{var n=t.options;n.navDate=t.getNavDate();var i=t.__jsonld.id;i||(i=t.__jsonld["@id"]),a.Utils.loadManifest(i).then((function(i){t.parentLabel=a.LanguageMap.getValue(t.getLabel(),n.locale);var r=a.Deserialiser.parse(i,n);(t=Object.assign(t,r)).index=n.index,e(t)}))}}))},e}(a.ManifestResource);e.IIIFResource=s},function(t,e,n){"use strict";var i,r=this&&this.__extends||(i=function(t,e){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(t,e)},function(t,e){function n(){this.constructor=t}i(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)});Object.defineProperty(e,"__esModule",{value:!0});var a=n(0),o=function(t){function e(e,n){return t.call(this,e,n)||this}return r(e,t),e.prototype.getBody=function(){var t=[],e=this.getProperty("body");if(e)if(Array.isArray(e))for(var n=0;n<e.length;n++)if((o=e[n]).items)for(var i=0;i<o.items.length;i++){var r=o.items[i];t.push(new a.AnnotationBody(r,this.options))}else t.push(new a.AnnotationBody(o,this.options));else if(e.items)for(n=0;n<e.items.length;n++){var o=e.items[n];t.push(new a.AnnotationBody(o,this.options))}else t.push(new a.AnnotationBody(e,this.options));return t},e.prototype.getMotivation=function(){return this.getProperty("motivation")||null},e.prototype.getOn=function(){return this.getProperty("on")},e.prototype.getTarget=function(){return this.getProperty("target")},e.prototype.getResource=function(){return new a.Resource(this.getProperty("resource"),this.options)},e}(a.ManifestResource);e.Annotation=o},function(t,e,n){"use strict";var i,r=this&&this.__extends||(i=function(t,e){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(t,e)},function(t,e){function n(){this.constructor=t}i(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)});Object.defineProperty(e,"__esModule",{value:!0});var a=n(0),o=function(t){function e(e,n){return t.call(this,e,n)||this}return r(e,t),e.prototype.getFormat=function(){var t=this.getProperty("format");return t?a.Utils.getMediaType(t):null},e.prototype.getType=function(){return this.getProperty("type")?a.Utils.normaliseType(this.getProperty("type")):null},e.prototype.getWidth=function(){return this.getProperty("width")},e.prototype.getHeight=function(){return this.getProperty("height")},e}(a.ManifestResource);e.AnnotationBody=o},function(t,e,n){"use strict";var i,r=this&&this.__extends||(i=function(t,e){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(t,e)},function(t,e){function n(){this.constructor=t}i(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)});Object.defineProperty(e,"__esModule",{value:!0});var a=n(0),o=function(t){function e(e,n,i){var r=t.call(this,n)||this;return r.label=e,r.options=i,r}return r(e,t),e.prototype.getIIIFResourceType=function(){return a.Utils.normaliseType(this.getProperty("type"))},e.prototype.getLabel=function(){return this.label},e.prototype.getResources=function(){var t=this;return this.getProperty("resources").map((function(e){return new a.Annotation(e,t.options)}))},e.prototype.load=function(){var t=this;return new Promise((function(e,n){if(t.isLoaded)e(t);else{var i=t.__jsonld.id;i||(i=t.__jsonld["@id"]),a.Utils.loadManifest(i).then((function(n){t.__jsonld=n,t.context=t.getProperty("context"),t.id=t.getProperty("id"),t.isLoaded=!0,e(t)})).catch(n)}}))},e}(a.JSONLDResource);e.AnnotationList=o},function(t,e,n){"use strict";var i,r=this&&this.__extends||(i=function(t,e){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(t,e)},function(t,e){function n(){this.constructor=t}i(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)});Object.defineProperty(e,"__esModule",{value:!0});var a=function(t){function e(e,n){return t.call(this,e,n)||this}return r(e,t),e.prototype.getItems=function(){return this.getProperty("items")},e}(n(0).ManifestResource);e.AnnotationPage=a},function(t,e,n){"use strict";var i,r=this&&this.__extends||(i=function(t,e){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(t,e)},function(t,e){function n(){this.constructor=t}i(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)});Object.defineProperty(e,"__esModule",{value:!0});var a=n(0),o=function(t){function e(e,n){return t.call(this,e,n)||this}return r(e,t),e.prototype.getCanonicalImageUri=function(t){var e,n=null,i="default",r=t;if(this.externalResource&&this.externalResource.data&&this.externalResource.data["@id"])n=this.externalResource.data["@id"],r||(r=this.externalResource.data.width),this.externalResource.data["@context"]&&(this.externalResource.data["@context"].indexOf("/1.0/context.json")>-1||this.externalResource.data["@context"].indexOf("/1.1/context.json")>-1||this.externalResource.data["@context"].indexOf("/1/context.json")>-1)&&(i="native");else{var o=this.getImages();if(o&&o.length){var s=o[0].getResource(),u=s.getServices();if(r||(r=s.getWidth()),u.length){var l=u[0];n=l.id,i=a.Utils.getImageQuality(l.getProfile())}else if(r===s.getWidth())return s.id}if(!n){var c=this.getProperty("thumbnail");if(c){if("string"==typeof c)return c;if(c["@id"])return c["@id"];if(c.length)return c[0].id}}}return e=r+",",n&&n.endsWith("/")&&(n=n.substr(0,n.length-1)),[n,"full",e,0,i+".jpg"].join("/")},e.prototype.getMaxDimensions=function(){var t,e=null;return this.externalResource&&this.externalResource.data&&this.externalResource.data.profile&&(t=this.externalResource.data.profile,Array.isArray(t)&&(t=t.filter((function(t){return t.maxWidth}))[0])&&(e=new a.Size(t.maxWidth,t.maxHeight?t.maxHeight:t.maxWidth))),e},e.prototype.getContent=function(){var t=[],e=this.__jsonld.items||this.__jsonld.content;if(!e)return t;var n=null;if(e.length&&(n=new a.AnnotationPage(e[0],this.options)),!n)return t;for(var i=n.getItems(),r=0;r<i.length;r++){var o=i[r],s=new a.Annotation(o,this.options);t.push(s)}return t},e.prototype.getDuration=function(){return this.getProperty("duration")},e.prototype.getImages=function(){var t=[];if(!this.__jsonld.images)return t;for(var e=0;e<this.__jsonld.images.length;e++){var n=this.__jsonld.images[e],i=new a.Annotation(n,this.options);t.push(i)}return t},e.prototype.getIndex=function(){return this.getProperty("index")},e.prototype.getOtherContent=function(){var t=this,e=(Array.isArray(this.getProperty("otherContent"))?this.getProperty("otherContent"):[this.getProperty("otherContent")]).filter((function(t){return t&&"string"==typeof(e=t["@type"])&&e.toLowerCase()==e.toLowerCase();var e})).map((function(e,n){return new a.AnnotationList(e.label||"Annotation list "+n,e,t.options)})).map((function(t){return t.load()}));return Promise.all(e)},e.prototype.getWidth=function(){return this.getProperty("width")},e.prototype.getHeight=function(){return this.getProperty("height")},e}(a.Resource);e.Canvas=o},function(t,e,n){"use strict";var i,r=this&&this.__extends||(i=function(t,e){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(t,e)},function(t,e){function n(){this.constructor=t}i(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)});Object.defineProperty(e,"__esModule",{value:!0});var a=n(1),o=n(0),s=function(t){function e(e,n){var i=t.call(this,e,n)||this;return i.items=[],i._collections=null,i._manifests=null,e.__collection=i,i}return r(e,t),e.prototype.getCollections=function(){return this._collections?this._collections:this._collections=this.items.filter((function(t){return t.isCollection()}))},e.prototype.getManifests=function(){return this._manifests?this._manifests:this._manifests=this.items.filter((function(t){return t.isManifest()}))},e.prototype.getCollectionByIndex=function(t){for(var e,n=this.getCollections(),i=0;i<n.length;i++){var r=n[i];r.index===t&&(e=r)}if(e)return e.options.index=t,e.load();throw new Error("Collection index not found")},e.prototype.getManifestByIndex=function(t){for(var e,n=this.getManifests(),i=0;i<n.length;i++){var r=n[i];r.index===t&&(e=r)}if(e)return e.options.index=t,e.load();throw new Error("Manifest index not found")},e.prototype.getTotalCollections=function(){return this.getCollections().length},e.prototype.getTotalManifests=function(){return this.getManifests().length},e.prototype.getTotalItems=function(){return this.items.length},e.prototype.getViewingDirection=function(){return this.getProperty("viewingDirection")?this.getProperty("viewingDirection"):a.ViewingDirection.LEFT_TO_RIGHT},e.prototype.getDefaultTree=function(){return t.prototype.getDefaultTree.call(this),this.defaultTree.data.type=o.Utils.normaliseType(o.TreeNodeType.COLLECTION),this._parseManifests(this),this._parseCollections(this),o.Utils.generateTreeNodeIds(this.defaultTree),this.defaultTree},e.prototype._parseManifests=function(t){if(t.getManifests()&&t.getManifests().length)for(var e=0;e<t.getManifests().length;e++){var n=t.getManifests()[e],i=n.getDefaultTree();i.label=n.parentLabel||o.LanguageMap.getValue(n.getLabel(),this.options.locale)||"manifest "+(e+1),i.navDate=n.getNavDate(),i.data.id=n.id,i.data.type=o.Utils.normaliseType(o.TreeNodeType.MANIFEST),t.defaultTree.addNode(i)}},e.prototype._parseCollections=function(t){if(t.getCollections()&&t.getCollections().length)for(var e=0;e<t.getCollections().length;e++){var n=t.getCollections()[e],i=n.getDefaultTree();i.label=n.parentLabel||o.LanguageMap.getValue(n.getLabel(),this.options.locale)||"collection "+(e+1),i.navDate=n.getNavDate(),i.data.id=n.id,i.data.type=o.Utils.normaliseType(o.TreeNodeType.COLLECTION),t.defaultTree.addNode(i)}},e}(o.IIIFResource);e.Collection=s},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=function(){function t(t,e){this.start=t,this.end=e}return t.prototype.getLength=function(){return this.end-this.start},t}();e.Duration=i},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=n(0),r=function(){function t(t){this.defaultLocale=t}return t.prototype.parse=function(t){this.resource=t,this.label=i.LanguageMap.parse(this.resource.label,this.defaultLocale),this.value=i.LanguageMap.parse(this.resource.value,this.defaultLocale)},t.prototype.getLabel=function(){return this.label?i.LanguageMap.getValue(this.label,this.defaultLocale):null},t.prototype.setLabel=function(t){var e=this;if(this.label&&this.label.length){var n=this.label.filter((function(t){return t.locale===e.defaultLocale||t.locale===i.Utils.getInexactLocale(e.defaultLocale)}))[0];n&&(n.value=t)}},t.prototype.getValue=function(){if(this.value){var t=this.defaultLocale;return this.label&&this.label.length&&this.label[0].locale&&(t=this.label[0].locale),i.LanguageMap.getValue(this.value,t)}return null},t.prototype.setValue=function(t){var e=this;if(this.value&&this.value.length){var n=this.value.filter((function(t){return t.locale===e.defaultLocale||t.locale===i.Utils.getInexactLocale(e.defaultLocale)}))[0];n&&(n.value=t)}},t}();e.LabelValuePair=r},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.Language=function(t,e){Array.isArray(t)?1===t.length?this.value=t[0]:this.value=t.join("<br/>"):this.value=t,this.locale=e}},function(t,e,n){"use strict";var i,r=this&&this.__extends||(i=function(t,e){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(t,e)},function(t,e){function n(){this.constructor=t}i(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)});Object.defineProperty(e,"__esModule",{value:!0});var a=n(0),o=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return r(e,t),e.parse=function(t,e){var n,i=[];if(!t)return i;if(Array.isArray(t))for(var r=0;r<t.length;r++){var o=t[r];n="string"==typeof o?new a.Language(o,e):new a.Language(o["@value"],o["@language"]||e),i.push(n)}else{if("string"==typeof t)return n=new a.Language(t,e),i.push(n),i;t["@value"]?(n=new a.Language(t["@value"],t["@language"]||e),i.push(n)):Object.keys(t).forEach((function(e){if(!t[e].length)throw new Error("language must have a value");n=new a.Language(t[e],e),i.push(n)}))}return i},e.getValue=function(t,e){if(t.length){if(e){var n=t.filter((function(t){return t.locale===e||a.Utils.getInexactLocale(t.locale)===a.Utils.getInexactLocale(e)}))[0];if(n)return n.value}return t[0].value}return null},e}(Array);e.LanguageMap=o},function(t,e,n){"use strict";var i,r=this&&this.__extends||(i=function(t,e){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(t,e)},function(t,e){function n(){this.constructor=t}i(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)});Object.defineProperty(e,"__esModule",{value:!0});var a=n(1),o=n(0),s=function(t){function e(e,n){var i=t.call(this,e,n)||this;if(i.index=0,i._allRanges=null,i.items=[],i._topRanges=[],i.__jsonld.structures&&i.__jsonld.structures.length)for(var r=i._getTopRanges(),a=0;a<r.length;a++){var o=r[a];i._parseRanges(o,String(a))}return i}return r(e,t),e.prototype.getPosterCanvas=function(){var t=this.getProperty("posterCanvas");return t&&(t=new o.Canvas(t,this.options)),t},e.prototype.getBehavior=function(){var t=this.getProperty("behavior");return Array.isArray(t)&&(t=t[0]),t||null},e.prototype.getDefaultTree=function(){if(t.prototype.getDefaultTree.call(this),this.defaultTree.data.type=o.Utils.normaliseType(o.TreeNodeType.MANIFEST),!this.isLoaded)return this.defaultTree;var e=this.getTopRanges();return e.length&&e[0].getTree(this.defaultTree),o.Utils.generateTreeNodeIds(this.defaultTree),this.defaultTree},e.prototype._getTopRanges=function(){var t=[];if(this.__jsonld.structures&&this.__jsonld.structures.length){for(var e=0;e<this.__jsonld.structures.length;e++){var n=this.__jsonld.structures[e];n.viewingHint===a.ViewingHint.TOP&&t.push(n)}if(!t.length){var i={};i.ranges=this.__jsonld.structures,t.push(i)}}return t},e.prototype.getTopRanges=function(){return this._topRanges},e.prototype._getRangeById=function(t){if(this.__jsonld.structures&&this.__jsonld.structures.length)for(var e=0;e<this.__jsonld.structures.length;e++){var n=this.__jsonld.structures[e];if(n["@id"]===t||n.id===t)return n}return null},e.prototype._parseRanges=function(t,e,n){var i,r=null;if("string"==typeof t&&(r=t,t=this._getRangeById(r)),t){(i=new o.Range(t,this.options)).parentRange=n,i.path=e,n?n.items.push(i):this._topRanges.push(i);var a=t.items||t.members;if(a)for(var s=0;s<a.length;s++){var u=a[s];if(u["@type"]&&"sc:range"===u["@type"].toLowerCase()||u.type&&"range"===u.type.toLowerCase())this._parseRanges(u,e+"/"+s,i);else if(u["@type"]&&"sc:canvas"===u["@type"].toLowerCase()||u.type&&"canvas"===u.type.toLowerCase()){i.canvases||(i.canvases=[]);var l=u.id||u["@id"];i.canvases.push(l)}}else if(t.ranges)for(s=0;s<t.ranges.length;s++)this._parseRanges(t.ranges[s],e+"/"+s,i)}else console.warn("Range:",r,"does not exist")},e.prototype.getAllRanges=function(){if(null!=this._allRanges)return this._allRanges;this._allRanges=[];for(var t=this.getTopRanges(),e=function(e){var i=t[e];i.id&&n._allRanges.push(i);var r=function(t,e){t.add(e);var n=e.getRanges();return n.length?n.reduce(r,t):t},a=Array.from(i.getRanges().reduce(r,new Set));n._allRanges=n._allRanges.concat(a)},n=this,i=0;i<t.length;i++)e(i);return this._allRanges},e.prototype.getRangeById=function(t){for(var e=this.getAllRanges(),n=0;n<e.length;n++){var i=e[n];if(i.id===t)return i}return null},e.prototype.getRangeByPath=function(t){for(var e=this.getAllRanges(),n=0;n<e.length;n++){var i=e[n];if(i.path===t)return i}return null},e.prototype.getSequences=function(){if(this.items.length)return this.items;var t=this.__jsonld.mediaSequences||this.__jsonld.sequences;if(t)for(var e=0;e<t.length;e++){var n=t[e],i=new o.Sequence(n,this.options);this.items.push(i)}else this.__jsonld.items&&(i=new o.Sequence(this.__jsonld.items,this.options),this.items.push(i));return this.items},e.prototype.getSequenceByIndex=function(t){return this.getSequences()[t]},e.prototype.getTotalSequences=function(){return this.getSequences().length},e.prototype.getManifestType=function(){var t=this.getService(a.ServiceProfile.UI_EXTENSIONS);return t?t.getProperty("manifestType"):o.ManifestType.EMPTY},e.prototype.isMultiSequence=function(){return this.getTotalSequences()>1},e.prototype.isPagingEnabled=function(){var t=this.getViewingHint();if(t)return t===a.ViewingHint.PAGED;var e=this.getBehavior();return!!e&&e===a.Behavior.PAGED},e.prototype.getViewingDirection=function(){return this.getProperty("viewingDirection")},e.prototype.getViewingHint=function(){return this.getProperty("viewingHint")},e}(o.IIIFResource);e.Manifest=s},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),function(t){t.EMPTY="",t.MANUSCRIPT="manuscript",t.MONOGRAPH="monograph"}(e.ManifestType||(e.ManifestType={}))},function(t,e,n){"use strict";var i,r=this&&this.__extends||(i=function(t,e){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(t,e)},function(t,e){function n(){this.constructor=t}i(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)});Object.defineProperty(e,"__esModule",{value:!0});var a=n(0),o=n(1),s=function(t){function e(e,n){var i=t.call(this,e,n)||this;return i._ranges=null,i.canvases=null,i.items=[],i}return r(e,t),e.prototype.getCanvasIds=function(){return this.__jsonld.canvases?this.__jsonld.canvases:this.canvases?this.canvases:[]},e.prototype.getDuration=function(){var t,e;if(this.canvases&&this.canvases.length)for(var n=0;n<this.canvases.length;n++){var i=this.canvases[n],r=a.Utils.getTemporalComponent(i);r&&r.length>1&&(0===n&&(t=Number(r[0])),n===this.canvases.length-1&&(e=Number(r[1])))}else{var o=this.getRanges();for(n=0;n<o.length;n++){var s=o[n].getDuration();s&&(0===n&&(t=s.start),n===o.length-1&&(e=s.end))}}if(void 0!==t&&void 0!==e)return new a.Duration(t,e)},e.prototype.getRanges=function(){return this._ranges?this._ranges:this._ranges=this.items.filter((function(t){return t.isRange()}))},e.prototype.getBehavior=function(){var t=this.getProperty("behavior");return Array.isArray(t)&&(t=t[0]),t||null},e.prototype.getViewingDirection=function(){return this.getProperty("viewingDirection")},e.prototype.getViewingHint=function(){return this.getProperty("viewingHint")},e.prototype.getTree=function(t){t.data=this,this.treeNode=t;var e=this.getRanges();if(e&&e.length)for(var n=0;n<e.length;n++){var i=e[n],r=new a.TreeNode;t.addNode(r),this._parseTreeNode(r,i)}return a.Utils.generateTreeNodeIds(t),t},e.prototype.spansTime=function(t){var e=this.getDuration();return!!(e&&t>=e.start&&t<=e.end)},e.prototype._parseTreeNode=function(t,e){t.label=a.LanguageMap.getValue(e.getLabel(),this.options.locale),t.data=e,t.data.type=a.Utils.normaliseType(a.TreeNodeType.RANGE),e.treeNode=t;var n=e.getRanges();if(n&&n.length)for(var i=0;i<n.length;i++){var r=n[i];if(r.getBehavior()!==o.Behavior.NO_NAV){var s=new a.TreeNode;t.addNode(s),this._parseTreeNode(s,r)}}},e}(a.ManifestResource);e.Range=s},function(t,e,n){"use strict";var i,r=this&&this.__extends||(i=function(t,e){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(t,e)},function(t,e){function n(){this.constructor=t}i(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)});Object.defineProperty(e,"__esModule",{value:!0});var a=function(t){function e(e,n){return t.call(this,e,n)||this}return r(e,t),e.prototype.getFormat=function(){return this.getProperty("format")},e}(n(0).ManifestResource);e.Rendering=a},function(t,e,n){"use strict";var i,r=this&&this.__extends||(i=function(t,e){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(t,e)},function(t,e){function n(){this.constructor=t}i(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)});Object.defineProperty(e,"__esModule",{value:!0});var a=n(1),o=n(0),s=function(t){function e(e,n){var i=t.call(this,e,n)||this;return i.items=[],i._thumbnails=null,i}return r(e,t),e.prototype.getCanvases=function(){if(this.items.length)return this.items;var t=this.__jsonld.canvases||this.__jsonld.elements;if(t)for(var e=0;e<t.length;e++){var n=t[e];(i=new o.Canvas(n,this.options)).index=e,this.items.push(i)}else if(this.__jsonld)for(e=0;e<this.__jsonld.length;e++){var i;n=this.__jsonld[e],(i=new o.Canvas(n,this.options)).index=e,this.items.push(i)}return this.items},e.prototype.getCanvasById=function(t){for(var e=0;e<this.getTotalCanvases();e++){var n=this.getCanvasByIndex(e),i=o.Utils.normaliseUrl(n.id);if(o.Utils.normaliseUrl(t)===i)return n}return null},e.prototype.getCanvasByIndex=function(t){return this.getCanvases()[t]},e.prototype.getCanvasIndexById=function(t){for(var e=0;e<this.getTotalCanvases();e++)if(this.getCanvasByIndex(e).id===t)return e;return null},e.prototype.getCanvasIndexByLabel=function(t,e){t=t.trim(),isNaN(t)||(t=parseInt(t,10).toString(),e&&(t+="r"));for(var n,i,r,a=/(\d*)\D+(\d*)/,s=0;s<this.getTotalCanvases();s++){var u=this.getCanvasByIndex(s);if(o.LanguageMap.getValue(u.getLabel(),this.options.locale)===t)return s;if((n=a.exec(t))&&(i=n[1],(r=n[2])&&new RegExp("^"+i+"\\D+"+r+"$").test(u.getLabel().toString())))return s}return-1},e.prototype.getLastCanvasLabel=function(t){for(var e=this.getTotalCanvases()-1;e>=0;e--){var n=this.getCanvasByIndex(e),i=o.LanguageMap.getValue(n.getLabel(),this.options.locale);if(t){if(/^[a-zA-Z0-9]*$/.test(i))return i}else if(i)return i}return this.options.defaultLabel},e.prototype.getLastPageIndex=function(){return this.getTotalCanvases()-1},e.prototype.getNextPageIndex=function(t,e){var n;if(e){var i=this.getPagedIndices(t),r=this.getViewingDirection();n=r&&r===a.ViewingDirection.RIGHT_TO_LEFT?i[0]+1:i[i.length-1]+1}else n=t+1;return n>this.getLastPageIndex()?-1:n},e.prototype.getPagedIndices=function(t,e){var n=[];if(e){n=this.isFirstCanvas(t)||this.isLastCanvas(t)?[t]:t%2?[t,t+1]:[t-1,t];var i=this.getViewingDirection();i&&i===a.ViewingDirection.RIGHT_TO_LEFT&&(n=n.reverse())}else n.push(t);return n},e.prototype.getPrevPageIndex=function(t,e){var n;if(e){var i=this.getPagedIndices(t),r=this.getViewingDirection();n=r&&r===a.ViewingDirection.RIGHT_TO_LEFT?i[i.length-1]-1:i[0]-1}else n=t-1;return n},e.prototype.getStartCanvasIndex=function(){var t=this.getStartCanvas();if(t)for(var e=0;e<this.getTotalCanvases();e++)if(this.getCanvasByIndex(e).id===t)return e;return 0},e.prototype.getThumbs=function(t,e){for(var n=[],i=this.getTotalCanvases(),r=0;r<i;r++){var a=this.getCanvasByIndex(r),s=new o.Thumb(t,a);n.push(s)}return n},e.prototype.getThumbnails=function(){if(null!=this._thumbnails)return this._thumbnails;this._thumbnails=[];for(var t=this.getCanvases(),e=0;e<t.length;e++){var n=t[e].getThumbnail();n&&this._thumbnails.push(n)}return this._thumbnails},e.prototype.getStartCanvas=function(){return this.getProperty("startCanvas")},e.prototype.getTotalCanvases=function(){return this.getCanvases().length},e.prototype.getViewingDirection=function(){return this.getProperty("viewingDirection")?this.getProperty("viewingDirection"):this.options.resource.getViewingDirection?this.options.resource.getViewingDirection():null},e.prototype.getViewingHint=function(){return this.getProperty("viewingHint")},e.prototype.isCanvasIndexOutOfRange=function(t){return t>this.getTotalCanvases()-1},e.prototype.isFirstCanvas=function(t){return 0===t},e.prototype.isLastCanvas=function(t){return t===this.getTotalCanvases()-1},e.prototype.isMultiCanvas=function(){return this.getTotalCanvases()>1},e.prototype.isPagingEnabled=function(){var t=this.getViewingHint();return!!t&&t===a.ViewingHint.PAGED},e.prototype.isTotalCanvasesEven=function(){return this.getTotalCanvases()%2==0},e}(o.ManifestResource);e.Sequence=s},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=n(0),r=function(){function t(){}return t.parse=function(t,e){return"string"==typeof t&&(t=JSON.parse(t)),this.parseJson(t,e)},t.parseJson=function(t,e){var n;if(e&&e.navDate&&!isNaN(e.navDate.getTime())&&(t.navDate=e.navDate.toString()),t["@type"])switch(t["@type"]){case"sc:Collection":n=this.parseCollection(t,e);break;case"sc:Manifest":n=this.parseManifest(t,e);break;default:return null}else switch(t.type){case"Collection":n=this.parseCollection(t,e);break;case"Manifest":n=this.parseManifest(t,e);break;default:return null}return n.isLoaded=!0,n},t.parseCollection=function(t,e){var n=new i.Collection(t,e);return e?(n.index=e.index||0,e.resource&&(n.parentCollection=e.resource.parentCollection)):n.index=0,this.parseCollections(n,e),this.parseManifests(n,e),this.parseItems(n,e),n},t.parseCollections=function(t,e){var n;if(t.__jsonld.collections?n=t.__jsonld.collections:t.__jsonld.items&&(n=t.__jsonld.items.filter((function(t){return"collection"===t.type.toLowerCase()}))),n)for(var i=0;i<n.length;i++){e&&(e.index=i);var r=this.parseCollection(n[i],e);r.index=i,r.parentCollection=t,t.items.push(r)}},t.parseManifest=function(t,e){return new i.Manifest(t,e)},t.parseManifests=function(t,e){var n;if(t.__jsonld.manifests?n=t.__jsonld.manifests:t.__jsonld.items&&(n=t.__jsonld.items.filter((function(t){return"manifest"===t.type.toLowerCase()}))),n)for(var i=0;i<n.length;i++){var r=this.parseManifest(n[i],e);r.index=i,r.parentCollection=t,t.items.push(r)}},t.parseItem=function(t,e){if(t["@type"]){if("sc:manifest"===t["@type"].toLowerCase())return this.parseManifest(t,e);if("sc:collection"===t["@type"].toLowerCase())return this.parseCollection(t,e)}else if(t.type){if("manifest"===t.type.toLowerCase())return this.parseManifest(t,e);if("collection"===t.type.toLowerCase())return this.parseCollection(t,e)}return null},t.parseItems=function(t,e){var n=t.__jsonld.members||t.__jsonld.items;if(n)for(var i=function(i){e&&(e.index=i);var a=r.parseItem(n[i],e);return a?t.items.filter((function(t){return t.id===a.id}))[0]?"continue":(a.index=i,a.parentCollection=t,void t.items.push(a)):{value:void 0}},r=this,a=0;a<n.length;a++){var o=i(a);if("object"==typeof o)return o.value}},t}();e.Deserialiser=r},function(t,e,n){"use strict";var i,r=this&&this.__extends||(i=function(t,e){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(t,e)},function(t,e){function n(){this.constructor=t}i(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)});Object.defineProperty(e,"__esModule",{value:!0});var a=n(0),o=function(t){function e(e,n){return t.call(this,e,n)||this}return r(e,t),e.prototype.getProfile=function(){var t=this.getProperty("profile");return t||(t=this.getProperty("dcterms:conformsTo")),Array.isArray(t)?t[0]:t},e.prototype.getConfirmLabel=function(){return a.Utils.getLocalisedValue(this.getProperty("confirmLabel"),this.options.locale)},e.prototype.getDescription=function(){return a.Utils.getLocalisedValue(this.getProperty("description"),this.options.locale)},e.prototype.getFailureDescription=function(){return a.Utils.getLocalisedValue(this.getProperty("failureDescription"),this.options.locale)},e.prototype.getFailureHeader=function(){return a.Utils.getLocalisedValue(this.getProperty("failureHeader"),this.options.locale)},e.prototype.getHeader=function(){return a.Utils.getLocalisedValue(this.getProperty("header"),this.options.locale)},e.prototype.getServiceLabel=function(){return a.Utils.getLocalisedValue(this.getProperty("label"),this.options.locale)},e.prototype.getInfoUri=function(){var t=this.id;return t.endsWith("/")||(t+="/"),t+"info.json"},e}(a.ManifestResource);e.Service=o},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.Size=function(t,e){this.width=t,this.height=e}},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),function(t){t[t.AUTHORIZATION_FAILED=1]="AUTHORIZATION_FAILED",t[t.FORBIDDEN=2]="FORBIDDEN",t[t.INTERNAL_SERVER_ERROR=3]="INTERNAL_SERVER_ERROR",t[t.RESTRICTED=4]="RESTRICTED"}(e.StatusCode||(e.StatusCode={}))},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=n(0);e.Thumb=function(t,e){this.data=e,this.index=e.index,this.width=t;var n=e.getHeight()/e.getWidth();this.height=n?Math.floor(this.width*n):t,this.uri=e.getCanonicalImageUri(t),this.label=i.LanguageMap.getValue(e.getLabel())}},function(t,e,n){"use strict";var i,r=this&&this.__extends||(i=function(t,e){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(t,e)},function(t,e){function n(){this.constructor=t}i(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)});Object.defineProperty(e,"__esModule",{value:!0});var a=function(t){function e(e,n){return t.call(this,e,n)||this}return r(e,t),e}(n(0).Resource);e.Thumbnail=a},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=n(0),r=function(){function t(t,e){this.label=t,this.data=e||{},this.nodes=[]}return t.prototype.addNode=function(t){this.nodes.push(t),t.parentNode=this},t.prototype.isCollection=function(){return this.data.type===i.Utils.normaliseType(i.TreeNodeType.COLLECTION)},t.prototype.isManifest=function(){return this.data.type===i.Utils.normaliseType(i.TreeNodeType.MANIFEST)},t.prototype.isRange=function(){return this.data.type===i.Utils.normaliseType(i.TreeNodeType.RANGE)},t}();e.TreeNode=r},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),function(t){t.COLLECTION="collection",t.MANIFEST="manifest",t.RANGE="range"}(e.TreeNodeType||(e.TreeNodeType={}))},function(t,e,n){window,t.exports=function(t){var e={};function n(i){if(e[i])return e[i].exports;var r=e[i]={i:i,l:!1,exports:{}};return t[i].call(r.exports,r,r.exports,n),r.l=!0,r.exports}return n.m=t,n.c=e,n.d=function(t,e,i){n.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:i})},n.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},n.t=function(t,e){if(1&e&&(t=n(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var i=Object.create(null);if(n.r(i),Object.defineProperty(i,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var r in t)n.d(i,r,function(e){return t[e]}.bind(null,r));return i},n.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return n.d(e,"a",e),e},n.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},n.p="",n(n.s=0)}([function(t,e,n){t.exports=n(1)},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.CONTINUE=100,e.SWITCHING_PROTOCOLS=101,e.PROCESSING=102,e.OK=200,e.CREATED=201,e.ACCEPTED=202,e.NON_AUTHORITATIVE_INFORMATION=203,e.NO_CONTENT=204,e.RESET_CONTENT=205,e.PARTIAL_CONTENT=206,e.MULTI_STATUS=207,e.MULTIPLE_CHOICES=300,e.MOVED_PERMANENTLY=301,e.MOVED_TEMPORARILY=302,e.SEE_OTHER=303,e.NOT_MODIFIED=304,e.USE_PROXY=305,e.TEMPORARY_REDIRECT=307,e.BAD_REQUEST=400,e.UNAUTHORIZED=401,e.PAYMENT_REQUIRED=402,e.FORBIDDEN=403,e.NOT_FOUND=404,e.METHOD_NOT_ALLOWED=405,e.NOT_ACCEPTABLE=406,e.PROXY_AUTHENTICATION_REQUIRED=407,e.REQUEST_TIME_OUT=408,e.CONFLICT=409,e.GONE=410,e.LENGTH_REQUIRED=411,e.PRECONDITION_FAILED=412,e.REQUEST_ENTITY_TOO_LARGE=413,e.REQUEST_URI_TOO_LARGE=414,e.UNSUPPORTED_MEDIA_TYPE=415,e.REQUESTED_RANGE_NOT_SATISFIABLE=416,e.EXPECTATION_FAILED=417,e.IM_A_TEAPOT=418,e.UNPROCESSABLE_ENTITY=422,e.LOCKED=423,e.FAILED_DEPENDENCY=424,e.UNORDERED_COLLECTION=425,e.UPGRADE_REQUIRED=426,e.PRECONDITION_REQUIRED=428,e.TOO_MANY_REQUESTS=429,e.REQUEST_HEADER_FIELDS_TOO_LARGE=431,e.INTERNAL_SERVER_ERROR=500,e.NOT_IMPLEMENTED=501,e.BAD_GATEWAY=502,e.SERVICE_UNAVAILABLE=503,e.GATEWAY_TIME_OUT=504,e.HTTP_VERSION_NOT_SUPPORTED=505,e.VARIANT_ALSO_NEGOTIATES=506,e.INSUFFICIENT_STORAGE=507,e.BANDWIDTH_LIMIT_EXCEEDED=509,e.NOT_EXTENDED=510,e.NETWORK_AUTHENTICATION_REQUIRED=511}])},function(t,e,n){t.exports=window.fetch||(window.fetch=n(3).default||n(3))}])},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=function(){function t(){}return t.VOLUME_CHANGED="volumechanged",t}();e.VolumeEvents=i},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=function(){function t(t,e){void 0===e&&(e={}),this.source=t,this.options=e}return t.prototype.attachTo=function(t){t.setAttribute("src",this.source)},t}();e.MediaFormat=i},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=function(){function t(){}return t.NEXT_RANGE="nextrange",t.PAUSECANVAS="pause",t.PLAYCANVAS="play",t.PREVIOUS_RANGE="previousrange",t}();e.CanvasInstanceEvents=i},function(t,e,n){"use strict";n.r(e),n.d(e,"BaseComponent",(function(){return i}));var i=function(){function t(t){this.options=t,this.options.data=Object.assign({},this.data(),t.data)}return t.prototype._init=function(){return this.el=this.options.target,this.el?(this.el.innerHTML="",!0):(console.warn("element not found"),!1)},t.prototype.data=function(){return{}},t.prototype.on=function(t,e,n){var i=this._e||(this._e={});(i[t]||(i[t]=[])).push({fn:e,ctx:n})},t.prototype.fire=function(t){for(var e=[],n=1;n<arguments.length;n++)e[n-1]=arguments[n];for(var i=[].slice.call(arguments,1),r=((this._e||(this._e={}))[t]||[]).slice(),a=0,o=r.length;a<o;a++)r[a].fn.apply(r[a].ctx,i)},t.prototype._resize=function(){},t.prototype.set=function(t){},t}()},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=n(0),r=n(16),a=n(6),o=function(){function t(){this.canvases=[],this.durationMap={},this.totalDuration=0,this.id=r.getTimestamp()}return t.prototype.addCanvas=function(t){this.canvases.push(jQuery.extend(!0,{},t));var e=t.getDuration()||0;this.totalDuration+=e,this.durationMap[t.id]={duration:e,runningDuration:this.totalDuration}},t.prototype.getContent=function(){var t=this,e=[];return this.canvases.forEach((function(n){var r=n.getContent();r.forEach((function(t){var e=t.getTarget();e&&(i.Utils.getTemporalComponent(e)||(t.__jsonld.target+="#t=0,"+n.getDuration()))})),r.forEach((function(e){var n=e.getTarget();n&&(e.__jsonld.target=a.retargetTemporalComponent(t.canvases,n))})),e.push.apply(e,r)})),e},t.prototype.getDuration=function(){var t=0;return this.canvases.forEach((function(e){var n=e.getDuration();n&&(t+=n)})),Math.floor(t)},t.prototype.getWidth=function(){return this.canvases.length?this.canvases[0].getWidth():0},t.prototype.getHeight=function(){return this.canvases.length?this.canvases[0].getHeight():0},t}();e.VirtualCanvas=o},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=n(0);e.retargetTemporalComponent=function(t,e){var n=i.Utils.getTemporalComponent(e);if(n){for(var r=0,a=e.substr(0,e.indexOf("#")),o=0;o<t.length;o++){var s=t[o];if(s.id.includes(a))break;var u=s.getDuration();u&&(r+=u)}return n[0]=Number(n[0])+r,n[1]=Number(n[1])+r,a+"#t="+n[0]+","+n[1]}}},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=n(8);e.isHLSFormat=function(t){return i.hlsMimeTypes.includes(t.toString())}},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.hlsMimeTypes=["application/vnd.apple.mpegurl","vnd.apple.mpegurl","audio/mpegurl","audio/x-mpegurl","application/x-mpegurl","video/x-mpegurl","video/mpegurl","application/mpegurl"]},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.isMpegDashFormat=function(t){return"application/dash+xml"===t.toString()}},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=n(8);e.canPlayHls=function(){var t="object"==typeof document&&document,e=t&&t.createElement("video");return Boolean(e&&e.canPlayType)&&i.hlsMimeTypes.some((function(t){return!!e&&/maybe|probably/i.test(e.canPlayType(t))}))}},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.isSafari=function(){return/^((?!chrome|android).)*safari/i.test(navigator.userAgent)}},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.getSpatialComponent=function(t){var e=/xywh=([^&]+)/g.exec(t),n=null;return e&&e[1]&&(n=e[1].split(",")),n}},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=function(){function t(){}return t.PLAY="play",t.PAUSE="pause",t.MEDIA_READY="mediaready",t.LOG="log",t.RANGE_CHANGED="rangechanged",t.WAVEFORM_READY="waveformready",t.WAVEFORMS_READY="waveformsready",t}();e.Events=i},function(t,e,n){"use strict";function i(t,e){var n=[];return Object.keys(t).forEach((function(i){Object.is(e[i],t[i])||n.push(i)})),n}Object.defineProperty(e,"__esModule",{value:!0}),e.diffData=function(t,e){return Array.from(new Set(i(t,e).concat(i(e,t))))}},function(t,e,n){"use strict";var i,r=this&&this.__extends||(i=function(t,e){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(t,e)},function(t,e){function n(){this.constructor=t}i(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)}),a=this&&this.__awaiter||function(t,e,n,i){return new(n||(n=Promise))((function(r,a){function o(t){try{u(i.next(t))}catch(t){a(t)}}function s(t){try{u(i.throw(t))}catch(t){a(t)}}function u(t){var e;t.done?r(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(o,s)}u((i=i.apply(t,e||[])).next())}))},o=this&&this.__generator||function(t,e){var n,i,r,a,o={label:0,sent:function(){if(1&r[0])throw r[1];return r[1]},trys:[],ops:[]};return a={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a;function s(a){return function(s){return function(a){if(n)throw new TypeError("Generator is already executing.");for(;o;)try{if(n=1,i&&(r=2&a[0]?i.return:a[0]?i.throw||((r=i.return)&&r.call(i),0):i.next)&&!(r=r.call(i,a[1])).done)return r;switch(i=0,r&&(a=[2&a[0],r.value]),a[0]){case 0:case 1:r=a;break;case 4:return o.label++,{value:a[1],done:!1};case 5:o.label++,i=a[1],a=[0];continue;case 7:a=o.ops.pop(),o.trys.pop();continue;default:if(!(r=o.trys,(r=r.length>0&&r[r.length-1])||6!==a[0]&&2!==a[0])){o=0;continue}if(3===a[0]&&(!r||a[1]>r[0]&&a[1]<r[3])){o.label=a[1];break}if(6===a[0]&&o.label<r[1]){o.label=r[1],r=a;break}if(r&&o.label<r[2]){o.label=r[2],o.ops.push(a);break}r[2]&&o.ops.pop(),o.trys.pop();continue}a=e.call(t,o)}catch(t){a=[6,t],i=0}finally{n=r=0}if(5&a[0])throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}([a,s])}}};Object.defineProperty(e,"__esModule",{value:!0});var s=n(0),u=n(3),l=n(4),c=n(1),h=n(5),p=n(17),f=n(14),d=n(25),v=n(13),_=function(t){function e(e){var n=t.call(this,e)||this;return n._data=n.data(),n.canvasInstances=[],n._readyMedia=0,n._readyWaveforms=0,n._posterCanvasWidth=0,n._posterCanvasHeight=0,n._posterImageExpanded=!1,n._init(),n._resize(),n}return r(e,t),e.prototype._init=function(){var e=t.prototype._init.call(this);return this._$element=$(this.el),e||console.error("Component failed to initialise"),e},e.prototype.getCurrentCanvasInstance=function(){var t=this._data.helper.getRangeById(this._data.range.id);if(!t)return null;var e=d.getFirstTargetedCanvasId(t);return e?this._data.helper.getCanvasById(e):null},e.prototype.data=function(){return{autoPlay:!1,constrainNavigationToRange:!1,defaultAspectRatio:.56,doubleClickMS:350,halveAtWidth:200,limitToRange:!1,posterImageRatio:.3,virtualCanvasEnabled:!0,content:{currentTime:"Current Time",collapse:"Collapse",duration:"Duration",expand:"Expand",mute:"Mute",next:"Next",pause:"Pause",play:"Play",previous:"Previous",unmute:"Unmute"},enableFastForward:!0,enableFastRewind:!0}},e.prototype.set=function(t){var e=this;console.groupCollapsed("Setting AV Component"),console.log("Data");var n=Object.assign({},this._data);this._data=Object.assign(this._data,t);var i=f.diffData(n,this._data);if(i.includes("helper")&&this._reset(),this._data.helper){if(this.canvasInstances.forEach((function(t,n){var r={};i.includes("limitToRange")&&e._data.canvasId&&(r.limitToRange=e._data.limitToRange),i.includes("constrainNavigationToRange")&&e._data.canvasId&&(r.constrainNavigationToRange=e._data.constrainNavigationToRange),i.includes("autoSelectRange")&&e._data.canvasId&&(r.autoSelectRange=e._data.autoSelectRange),t.set(r)})),(i.includes("virtualCanvasEnabled")||i.includes("canvasId"))&&this._data.canvasId){var r=this._getCanvasInstanceById(this._data.canvasId);r&&this.canvasInstances.forEach((function(t){t.getCanvasId()!==r.getCanvasId()?t.set({visible:!1}):i.includes("range")?t.set({visible:!0,range:e._data.range?jQuery.extend(!0,{},e._data.range):void 0}):t.set({visible:!0})}))}if(i.includes("virtualCanvasEnabled")&&(this.set({range:void 0}),this._data.virtualCanvasEnabled&&this.canvasInstances.forEach((function(t){t.isVirtual()&&e.set({canvasId:t.getCanvasId(),range:void 0})}))),i.includes("range")&&this._data.range){var a=this._data.helper.getRangeById(this._data.range.id);if(a){var o=d.getFirstTargetedCanvasId(a);if(o){var u=this._getCanvasInstanceById(o);if(u){if(u.isVirtual()&&this._data.virtualCanvasEnabled&&u.includesVirtualSubCanvas(o)){o=u.getCanvasId();for(var l=0;l<u.ranges.length;l++){var c=u.ranges[l];if(c.id===a.id){a=c;break}}}this._data.canvasId&&(this._data.canvasId.includes("://")?s.Utils.normaliseUrl(this._data.canvasId):this._data.canvasId)!==o?this.set({canvasId:o,range:jQuery.extend(!0,{},a)}):u.set({range:jQuery.extend(!0,{},a)})}}}else console.warn("range not found")}this._render(),this._resize(),console.groupEnd()}else console.warn("must pass a helper object")},e.prototype._render=function(){},e.prototype.reset=function(){this._reset()},e.prototype._reset=function(){var t=this;if(this._readyMedia=0,this._readyWaveforms=0,this._posterCanvasWidth=0,this._posterCanvasHeight=0,clearInterval(this._checkAllMediaReadyInterval),clearInterval(this._checkAllWaveformsReadyInterval),this.canvasInstances.forEach((function(t){t.destroy()})),this.canvasInstances=[],this._$element.empty(),this._data&&this._data.helper&&this._data.helper.manifest){var e=this._data.helper.manifest.getBehavior(),n=this._getCanvases();if(e&&"auto-advance"===e.toString()){var i=new h.VirtualCanvas;n.forEach((function(t){i.addCanvas(t)})),this._initCanvas(i)}n.forEach((function(e){t._initCanvas(e)})),this.canvasInstances.length>0&&(this._data.canvasId=this.canvasInstances[0].getCanvasId()),this._checkAllMediaReadyInterval=setInterval(this._checkAllMediaReady.bind(this),100),this._checkAllWaveformsReadyInterval=setInterval(this._checkAllWaveformsReady.bind(this),100),this._$posterContainer=$('<div class="poster-container"></div>'),this._$element.append(this._$posterContainer),this._$posterImage=$('<div class="poster-image"></div>'),this._$posterExpandButton=$('\n                    <button class="btn" title="'+(this._data&&this._data.content?this._data.content.expand:"")+'">\n                        <i class="av-icon  av-icon-expand expand" aria-hidden="true"></i><span>'+(this._data&&this._data.content?this._data.content.expand:"")+"</span>\n                    </button>\n                "),this._$posterImage.append(this._$posterExpandButton),this._$posterImage.on("touchstart click",(function(e){e.preventDefault();var n=t._getPosterImageCss(!t._posterImageExpanded);if(t._$posterImage.animate(n),t._posterImageExpanded=!t._posterImageExpanded,t._data.content)if(t._posterImageExpanded){var i=t._data.content.collapse;t._$posterExpandButton.prop("title",i),t._$posterExpandButton.find("i").switchClass("expand","collapse")}else{i=t._data.content.expand;t._$posterExpandButton.prop("title",i),t._$posterExpandButton.find("i").switchClass("collapse","expand")}}));var r=this._data.helper.getPosterCanvas();if(r){this._posterCanvasWidth=r.getWidth(),this._posterCanvasHeight=r.getHeight();var a=this._data.helper.getPosterImage();if(a){this._$posterContainer.append(this._$posterImage);var o=this._getPosterImageCss(this._posterImageExpanded);o=Object.assign({},o,{"background-image":"url("+a+")"}),this._$posterImage.css(o)}}}},e.prototype.setCurrentTime=function(t){return a(this,void 0,void 0,(function(){var e;return o(this,(function(n){return(e=this._getCurrentCanvas())?[2,e.setCurrentTime(t)]:[2]}))}))},e.prototype.getCurrentTime=function(){var t=this._getCurrentCanvas();return t?t.getClockTime():0},e.prototype.isPlaying=function(){return this.canvasInstances.reduce((function(t,e){return t||e.isPlaying()}),!1)},e.prototype._checkAllMediaReady=function(){this._readyMedia===this.canvasInstances.length&&(clearInterval(this._checkAllMediaReadyInterval),this.fire(v.Events.MEDIA_READY),this.resize())},e.prototype._checkAllWaveformsReady=function(){this._readyWaveforms===this._getCanvasInstancesWithWaveforms().length&&(clearInterval(this._checkAllWaveformsReadyInterval),this.fire(v.Events.WAVEFORMS_READY),this.resize())},e.prototype._getCanvasInstancesWithWaveforms=function(){return this.canvasInstances.filter((function(t){return t.waveforms.length>0}))},e.prototype._getCanvases=function(){return this._data.helper?this._data.helper.getCanvases():[]},e.prototype._initCanvas=function(t){var e=this,n=new p.CanvasInstance({target:document.createElement("div"),data:Object.assign({},{canvas:t},this._data)});n.logMessage=this._logMessage.bind(this),n.isOnlyCanvasInstance=1===this._getCanvases().length,this._$element.append(n.$playerElement),n.init(),this.canvasInstances.push(n),n.on("play",(function(){e.fire(v.Events.PLAY,n)}),!1),n.on("pause",(function(){e.fire(v.Events.PAUSE,n)}),!1),n.on(v.Events.MEDIA_READY,(function(){e._readyMedia++,n.loaded()}),!1),n.on(v.Events.WAVEFORM_READY,(function(){e._readyWaveforms++}),!1),n.on(u.CanvasInstanceEvents.PREVIOUS_RANGE,(function(){e._prevRange(),e.play()}),!1),n.on(u.CanvasInstanceEvents.NEXT_RANGE,(function(){e._nextRange(),e.play()}),!1),n.on(v.Events.RANGE_CHANGED,(function(t){e.fire(v.Events.RANGE_CHANGED,t)}),!1),n.on(c.VolumeEvents.VOLUME_CHANGED,(function(t){e._setCanvasInstanceVolumes(t),e.fire(c.VolumeEvents.VOLUME_CHANGED,t)}),!1)},e.prototype.getCurrentRange=function(){var t=this._data.helper.getCurrentRange().id;return this._getCurrentCanvas().ranges.find((function(e){return e.id===t}))||null},e.prototype._prevRange=function(){if(this._data&&this._data.helper){var t=this.getCurrentRange();if(t){var e=this.getCurrentTime(),n=t.getDuration().start||0;if(e-n>5)return void this.setCurrentTime(n)}var i=this._data.helper.getPreviousRange();i?this.playRange(i.id):this._rewind()}},e.prototype._nextRange=function(){if(this._data&&this._data.helper){var t=this._data.helper.getNextRange();t&&this.playRange(t.id)}},e.prototype._setCanvasInstanceVolumes=function(t){this.canvasInstances.forEach((function(e){e.set({volume:t})}))},e.prototype._getNormaliseCanvasId=function(t){return t.includes("://")?s.Utils.normaliseUrl(t):t},e.prototype._getCanvasInstanceById=function(t){if(t=this._getNormaliseCanvasId(t),this._data.virtualCanvasEnabled)for(var e=0;e<this.canvasInstances.length;e++){var n=(i=this.canvasInstances[e]).getCanvasId();if(n&&(n=this._getNormaliseCanvasId(n),(i.isVirtual()||1===this.canvasInstances.length)&&n===t||i.includesVirtualSubCanvas(t)))return i}else for(e=0;e<this.canvasInstances.length;e++){var i,r=(i=this.canvasInstances[e]).getCanvasId();if(r)if(s.Utils.normaliseUrl(r)===t)return i}},e.prototype._getCurrentCanvas=function(){if(this._data.canvasId)return this._getCanvasInstanceById(this._data.canvasId)},e.prototype._rewind=function(){if(!this._data.limitToRange){var t=this._getCurrentCanvas();t&&t.set({range:void 0})}},e.prototype.play=function(){var t=this._getCurrentCanvas();t&&t.play()},e.prototype.viewRange=function(t){var e=this._getCurrentCanvas();e&&e.viewRange(t)},e.prototype.pause=function(){var t=this._getCurrentCanvas();t&&t.pause()},e.prototype.playRange=function(t,e){if(void 0===e&&(e=!1),this._data.helper){var n=this._data.helper.getRangeById(t);n&&this.set({range:jQuery.extend(!0,{autoChanged:e},n)})}},e.prototype.showCanvas=function(t){var e=this._getCurrentCanvas();this._data.virtualCanvasEnabled&&e&&e.getCanvasId()===t&&!e.isVisible()?e.set({visible:!0}):this.set({canvasId:t})},e.prototype._logMessage=function(t){this.fire(v.Events.LOG,t)},e.prototype._getPosterImageCss=function(t){var e=this._getCurrentCanvas();if(e){var n=e.$playerElement.find(".options-container"),i=e.$playerElement.parent().width(),r=e.$playerElement.parent().height()-n.height();if(t)return{top:0,left:0,width:i,height:r};var a=void 0,o=void 0,s=void 0;return this._posterCanvasWidth>this._posterCanvasHeight?(a=this._posterCanvasHeight/this._posterCanvasWidth,s=(o=i*(this._data.posterImageRatio||1))*a):(a=this._posterCanvasWidth/this._posterCanvasHeight,o=(s=r*(this._data.posterImageRatio||1))*a),{top:0,left:i-o,width:o,height:s}}return null},e.prototype.resize=function(){this.canvasInstances.forEach((function(t){t.resize()})),this._getCurrentCanvas()&&this._$posterImage&&this._$posterImage.is(":visible")&&(this._posterImageExpanded?this._$posterImage.css(this._getPosterImageCss(!0)):this._$posterImage.css(this._getPosterImageCss(!1)))},e.newRanges=!0,e}(l.BaseComponent);e.AVComponent=_},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.getTimestamp=function(){return String((new Date).valueOf())}},function(t,e,n){"use strict";var i,r=this&&this.__extends||(i=function(t,e){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(t,e)},function(t,e){function n(){this.constructor=t}i(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)}),a=this&&this.__awaiter||function(t,e,n,i){return new(n||(n=Promise))((function(r,a){function o(t){try{u(i.next(t))}catch(t){a(t)}}function s(t){try{u(i.throw(t))}catch(t){a(t)}}function u(t){var e;t.done?r(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(o,s)}u((i=i.apply(t,e||[])).next())}))},o=this&&this.__generator||function(t,e){var n,i,r,a,o={label:0,sent:function(){if(1&r[0])throw r[1];return r[1]},trys:[],ops:[]};return a={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a;function s(a){return function(s){return function(a){if(n)throw new TypeError("Generator is already executing.");for(;o;)try{if(n=1,i&&(r=2&a[0]?i.return:a[0]?i.throw||((r=i.return)&&r.call(i),0):i.next)&&!(r=r.call(i,a[1])).done)return r;switch(i=0,r&&(a=[2&a[0],r.value]),a[0]){case 0:case 1:r=a;break;case 4:return o.label++,{value:a[1],done:!1};case 5:o.label++,i=a[1],a=[0];continue;case 7:a=o.ops.pop(),o.trys.pop();continue;default:if(!(r=o.trys,(r=r.length>0&&r[r.length-1])||6!==a[0]&&2!==a[0])){o=0;continue}if(3===a[0]&&(!r||a[1]>r[0]&&a[1]<r[3])){o.label=a[1];break}if(6===a[0]&&o.label<r[1]){o.label=r[1],r=a;break}if(r&&o.label<r[2]){o.label=r[2],o.ops.push(a);break}r[2]&&o.ops.pop(),o.trys.pop();continue}a=e.call(t,o)}catch(t){a=[6,t],i=0}finally{n=r=0}if(5&a[0])throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}([a,s])}}};Object.defineProperty(e,"__esModule",{value:!0});var s=n(0),u=n(4),l=n(28),c=n(33),h=n(1),p=n(18),f=n(19),d=n(34),v=n(20),_=n(21),g=n(3),m=n(15),y=n(5),E=n(35),T=n(13),C=n(7),I=n(9),P=n(6),w=n(12),O=n(10),M=n(22),R=n(11),b=n(23),A=n(14),S=n(24),L=function(t){function e(e){var n=t.call(this,e)||this;return n._canvasClockFrequency=25,n._canvasClockStartDate=0,n._canvasClockTime=0,n._canvasHeight=0,n._canvasWidth=0,n._data=n.data(),n._highPriorityFrequency=25,n._isPlaying=!1,n._isStalled=!1,n._lowPriorityFrequency=250,n._mediaSyncMarginSecs=1,n._rangeSpanPadding=.25,n._readyMediaCount=0,n._stallRequestedBy=[],n._wasPlaying=!1,n.ranges=[],n.waveforms=[],n._buffering=!1,n._bufferShown=!1,n.isOnlyCanvasInstance=!1,n.waveformDeltaX=0,n.waveformPageX=0,n.waveFormInit=!1,n._scaleY=function(t,e){return Math.max(n._data.waveformBarWidth,t*e/256)},n._$element=$(n.options.target),n._data=n.options.data,n.$playerElement=$('<div class="player player--loading"></div>'),n}return r(e,t),e.prototype.loaded=function(){var t=this;setTimeout((function(){t.$playerElement.removeClass("player--loading")}),500)},e.prototype.isPlaying=function(){return this._isPlaying},e.prototype.getClockTime=function(){return this._canvasClockTime},e.prototype.createTimeStops=function(){var t=this,e=this._data.helper,n=this._data.canvas;if(e&&n){this.ranges=[],this._contentAnnotations=[];for(var i=[],r=0,a=n.canvases;r<a.length;r++)for(var o=a[r],s=0,u=o.getContent();s<u.length;s++){var h=u[s],f=p.extractMediaFromAnnotationBodies(h);if(f){var g=_.getMediaSourceFromAnnotationBody(h,f,{id:o.id,duration:o.getDuration()||0,height:o.getHeight(),width:o.getWidth()}),m=new l.MediaElement(g,{adaptiveAuthEnabled:this._data.adaptiveAuthEnabled});m.setSize(this._convertToPercentage(g.x||0,o.getHeight()),this._convertToPercentage(g.y||0,o.getWidth()),this._convertToPercentage(g.width||o.getWidth(),o.getWidth()),this._convertToPercentage(g.height||o.getHeight(),o.getHeight())),i.push(m);var y=h.getProperty("seeAlso");if(y&&y.length){var E=y[0].id;this.waveforms.push(E)}}}var C=new d.CompositeMediaElement(i);C.appendTo(this.$playerElement),C.load().then((function(){t.fire(T.Events.MEDIA_READY)}));var I=v.createTimePlansFromManifest(e.manifest,i);window.timePlanPlayer=this.timePlanPlayer=new c.TimePlanPlayer(C,I,(function(e){t.setCurrentRangeId(e,{autoChanged:!0})}),(function(e){t._canvasClockTime=e}),(function(e){e?t.play():t.pause()}))}},e.prototype.init=function(){var t=this;if(this._data&&this._data.content&&this._data.canvas){this._$hoverPreviewTemplate=$('<div class="hover-preview"><div class="label"></div><div class="pointer"><span class="arrow"></span></div></div>'),this._$canvasContainer=$('<div class="canvas-container"></div>'),this._$optionsContainer=$('<div class="options-container"></div>'),this._$rangeTimelineContainer=$('<div class="range-timeline-container"></div>'),this._$canvasTimelineContainer=$('<div class="canvas-timeline-container"></div>'),this._$canvasHoverPreview=this._$hoverPreviewTemplate.clone(),this._$canvasHoverHighlight=$('<div class="hover-highlight"></div>'),this._$rangeHoverPreview=this._$hoverPreviewTemplate.clone(),this._$rangeHoverHighlight=$('<div class="hover-highlight"></div>'),this._$durationHighlight=$('<div class="duration-highlight"></div>'),this._$timelineItemContainer=$('<div class="timeline-item-container"></div>'),this._$controlsContainer=$('<div class="controls-container"></div>'),this._$prevButton=$('\n                                <button class="btn" title="'+this._data.content.previous+'">\n                                    <i class="av-icon av-icon-previous" aria-hidden="true"></i>'+this._data.content.previous+"\n                                </button>"),this._$playButton=$('\n                                <button class="btn" title="'+this._data.content.play+'">\n                                    <i class="av-icon av-icon-play play" aria-hidden="true"></i>'+this._data.content.play+"\n                                </button>"),this._$nextButton=$('\n                                <button class="btn" title="'+this._data.content.next+'">\n                                    <i class="av-icon av-icon-next" aria-hidden="true"></i>'+this._data.content.next+"\n                                </button>"),this._$fastForward=$('\n                                <button class="btn" title="'+this._data.content.next+'">\n                                    <i class="av-icon av-icon-fast-forward" aria-hidden="true"></i>'+(this._data.content.fastForward||"")+"\n                                </button>"),this._$fastRewind=$('\n                                <button class="btn" title="'+this._data.content.next+'">\n                                    <i class="av-icon av-icon-fast-rewind" aria-hidden="true"></i>'+(this._data.content.fastRewind||"")+"\n                                </button>"),this._$timeDisplay=$('<div class="time-display"><span class="canvas-time"></span> / <span class="canvas-duration"></span></div>'),this._$canvasTime=this._$timeDisplay.find(".canvas-time"),this._$canvasDuration=this._$timeDisplay.find(".canvas-duration"),this.isVirtual()&&this.$playerElement.addClass("virtual");var e=$('<div class="volume"></div>');this._volume=new f.AVVolumeControl({target:e[0],data:Object.assign({},this._data)}),this._volume.on(h.VolumeEvents.VOLUME_CHANGED,(function(e){t.fire(h.VolumeEvents.VOLUME_CHANGED,e)}),!1),this._$controlsContainer.append(this._$prevButton,this._data.enableFastRewind?this._$fastRewind:null,this._$playButton,this._data.enableFastForward?this._$fastForward:null,this._$nextButton,this._$timeDisplay,e),this._$canvasTimelineContainer.append(this._$canvasHoverPreview,this._$canvasHoverHighlight,this._$durationHighlight),this._$rangeTimelineContainer.append(this._$rangeHoverPreview,this._$rangeHoverHighlight),this._$optionsContainer.append(this._$canvasTimelineContainer,this._$rangeTimelineContainer,this._$controlsContainer),this.$playerElement.append(this._$canvasContainer,this._$optionsContainer),this._$canvasHoverPreview.hide(),this._$rangeHoverPreview.hide();var n=this.isVirtual()&&m.AVComponent.newRanges;if(n&&this.createTimeStops(),!n&&this._data&&this._data.helper&&this._data.canvas){var i=[];S.isVirtual(this._data.canvas)?this._data.canvas.canvases.forEach((function(e){if(t._data&&t._data.helper){var n=t._data.helper.getCanvasRanges(e),r=[];n.forEach((function(e){var n=jQuery.extend(!0,{},e);if(r.push(n),n.canvases&&n.canvases.length)for(var i=0;i<n.canvases.length;i++)S.isVirtual(t._data.canvas)&&(n.canvases[i]=P.retargetTemporalComponent(t._data.canvas.canvases,n.__jsonld.items[i].id))})),i.push.apply(i,r)}})):i=i.concat(this._data.helper.getCanvasRanges(this._data.canvas)),i.forEach((function(e){t.ranges.push(e)}))}var r=this._data.canvas.getWidth(),a=this._data.canvas.getHeight();this._canvasWidth=r||this.$playerElement.parent().width(),this._canvasHeight=a||this._canvasWidth*(this._data.defaultAspectRatio||1);var o=this,u=0,l=0;if(this._$prevButton.on("touchstart click",(function(e){e.preventDefault(),1===++u?(t._previous(!1),l=setTimeout((function(){u=0,l=0}),t._data.doubleClickMS)):(t._previous(!0),clearTimeout(l),u=0,l=0)})),this._$playButton.on("touchstart click",(function(e){e.preventDefault(),t._isPlaying?t.pause():t.play()})),this._$nextButton.on("touchstart click",(function(e){e.preventDefault(),t._next()})),this._$fastForward.on("touchstart click",(function(e){var n=t.getRangeTiming().end,i=t.getClockTime()+20;return i<n?t._setCurrentTime(i):t._setCurrentTime(n)})),this._$fastRewind.on("touchstart click",(function(e){var n=t.getRangeTiming().start,i=t.getClockTime()-20;return i>=n?t._setCurrentTime(i):t._setCurrentTime(n)})),n?this._$canvasTimelineContainer.slider({value:0,step:.01,orientation:"horizontal",range:"min",min:0,max:this.timePlanPlayer.getDuration(),animate:!1,slide:function(e,n){t._setCurrentTime(t.timePlanPlayer.plan.start+n.value)}}):this._$canvasTimelineContainer.slider({value:0,step:.01,orientation:"horizontal",range:"min",max:o._getDuration(),animate:!1,create:function(t,e){},slide:function(t,e){o._setCurrentTime(e.value)},stop:function(t,e){}}),this._$canvasTimelineContainer.mouseout((function(){o._$canvasHoverHighlight.width(0),o._$canvasHoverPreview.hide()})),this._$rangeTimelineContainer.mouseout((function(){o._$rangeHoverHighlight.width(0),o._$rangeHoverPreview.hide()})),this._$canvasTimelineContainer.on("mousemove",(function(e){n?t._updateHoverPreview(e,t._$canvasTimelineContainer,t.timePlanPlayer.getDuration()):t._updateHoverPreview(e,t._$canvasTimelineContainer,t._getDuration())})),this._$rangeTimelineContainer.on("mousemove",(function(e){if(n)t._updateHoverPreview(e,t._$canvasTimelineContainer,t.timePlanPlayer.getDuration());else if(t._data.range){var i=t._data.range.getDuration();t._updateHoverPreview(e,t._$rangeTimelineContainer,i?i.getLength():0)}})),!n){this._contentAnnotations=[];var c=this._data.canvas.getContent();this._$timelineItemContainer.hide();for(var p=0;p<c.length;p++){var d=c[p],v=void 0,_=d.getBody();if(!_.length)return void console.warn("item has no body");var g=this._getBody(_);if(g){var y=g.getType(),E=g.getFormat();y&&"textualbody"===y.toString()||(v=g.id.split("#")[0]);var T=d.getTarget();if(!T)return void console.warn("item has no target");var C=w.getSpatialComponent(T),I=s.Utils.getTemporalComponent(T);C||(C=[0,0,this._canvasWidth,this._canvasHeight]),I||(I=[0,this._getDuration()]);var O=parseInt(String(C[0])),M=parseInt(String(C[1])),R=parseInt(String(C[2])),b=parseInt(String(C[3])),A=parseInt(String(I[0])),L=parseInt(String(I[1])),x=this._convertToPercentage(M,this._canvasHeight),N=this._convertToPercentage(O,this._canvasWidth),D=this._convertToPercentage(R,this._canvasWidth),V=this._convertToPercentage(b,this._canvasHeight),j=/t=([^&]+)/g.exec(g.id),U=void 0,F=(U=j&&j[1]?j[1].split(","):[null,null])[0]?parseInt(U[0]):U[0],k={active:!1,end:L,endOffset:U[1]?parseInt(U[1]):U[1],format:E,height:V,left:N,source:v,start:A,startOffset:F,top:x,type:y,width:D};this._renderMediaElement(k);var G=d.getProperty("seeAlso");if(G&&G.length){var H=G[0].id;this.waveforms.push(H)}}else console.warn("unable to find suitable format for",d.id)}}}else console.warn("unable to initialise, missing canvas or content")},e.prototype._getBody=function(t){for(var e=0;e<t.length;e++){if((i=(n=t[e]).getFormat())&&C.isHLSFormat(i)&&O.canPlayHls())return n}for(e=0;e<t.length;e++){if((i=(n=t[e]).getFormat())&&I.isMpegDashFormat(i)&&!R.isSafari())return n}for(e=0;e<t.length;e++){var n,i;if((i=(n=t[e]).getFormat())&&!C.isHLSFormat(i)&&!I.isMpegDashFormat(i))return n}return null},e.prototype._getDuration=function(){return this.isVirtual()&&m.AVComponent.newRanges?this.timePlanPlayer.getDuration():this._data&&this._data.canvas?Math.floor(this._data.canvas.getDuration()):0},e.prototype.data=function(){return{waveformColor:"#fff",waveformBarSpacing:4,waveformBarWidth:2,volume:1}},e.prototype.isVirtual=function(){return this._data.canvas instanceof y.VirtualCanvas},e.prototype.isVisible=function(){return!!this._data.visible},e.prototype.includesVirtualSubCanvas=function(t){if(S.isVirtual(this._data.canvas)&&this._data.canvas&&this._data.canvas.canvases)for(var e=0;e<this._data.canvas.canvases.length;e++){var n=this._data.canvas.canvases[e];if(s.Utils.normaliseUrl(n.id)===t)return!0}return!1},e.prototype.setVisibility=function(t){this._data.visible!==t&&(this._data.visible=t,t?(this._rewind(),this.$playerElement.show()):(this.$playerElement.hide(),this.pause()),this.resize())},e.prototype.viewRange=function(t){this.currentRange!==t&&(console.log("Switching range from "+this.currentRange+" to "+t),this.setCurrentRangeId(t),this._setCurrentTime(this.timePlanPlayer.setRange(t),!0),this._render())},e.prototype.setCurrentRangeId=function(t,e){var n=void 0===e?{}:e;n.autoChanged,n.limitToRange;!this.currentRange&&t&&this.limitToRange,console.log("Setting current range id",t),t&&this.currentRange!==t?(this.currentRange=t,this.fire(T.Events.RANGE_CHANGED,t)):null===t&&(this.currentRange=void 0,this.fire(T.Events.RANGE_CHANGED,null)),this._render()},e.prototype.setVolume=function(t){this._volume.set({volume:t}),this.timePlanPlayer.setVolume(t)},e.prototype.setLimitToRange=function(t){console.log(this._data.constrainNavigationToRange),this.limitToRange!==t&&(this.limitToRange=t,this._render())},e.prototype.set=function(t){var e=this;if(m.AVComponent.newRanges&&this.isVirtual())return void 0!==t.range&&this.setCurrentRangeId(t.range.id,{limitToRange:t.limitToRange}),void 0!==t.rangeId&&this.setCurrentRangeId(t.rangeId,{limitToRange:t.limitToRange}),void 0!==t.volume&&this.setVolume(t.volume),void 0!==t.limitToRange&&this.setLimitToRange(t.limitToRange),void(void 0!==t.visible&&this.setVisibility(t.visible));var n=Object.assign({},this._data);this._data=Object.assign(this._data,t);var i=A.diffData(n,this._data);if(i.includes("visible")&&this._data.canvas&&(this._data.visible?(this._rewind(),this.$playerElement.show()):(this.$playerElement.hide(),this.pause()),this.resize()),i.includes("range")){if(this._data.helper)if(this._data.range){var r=this._data.range.getDuration();r&&void 0!==r&&((r.start>=this._canvasClockTime||r.end<=this._canvasClockTime)&&this._setCurrentTime(r.start),this._data.autoPlay&&this.play(),this.fire(T.Events.RANGE_CHANGED,this._data.range.id,this._data.range))}else this.fire(T.Events.RANGE_CHANGED,null);i.includes("volume")?this._contentAnnotations.forEach((function(t){var n=void 0!==e._data.volume?e._data.volume:1;$(t.element).prop("volume",n),e._volume.set({volume:e._data.volume})})):this.isVisible()&&this._render(),i.includes("limitToRange")&&this._render()}},e.prototype._hasRangeChanged=function(){if(!this.isVirtual()||!m.AVComponent.newRanges){var t=this._getRangeForCurrentTime();t&&!this._data.limitToRange&&(!this._data.range||this._data.range&&t.id!==this._data.range.id)&&(console.log("Did you change the range?",t),this.set({range:jQuery.extend(!0,{autoChanged:!0},t)}))}},e.prototype._getRangeForCurrentTime=function(t){var e;e=t?t.getRanges():this.ranges;for(var n=0;n<e.length;n++){var i=e[n],r=i.getBehavior();if((!r||"no-nav"===r)&&this._rangeSpansCurrentTime(i)){if(this._rangeNavigable(i))return i;for(var a=i.getRanges(),o=0;o<a.length;o++){var s=a[o];if(this._rangeSpansCurrentTime(s))return this._getRangeForCurrentTime(s)}return i.parentRange}}},e.prototype._rangeSpansCurrentTime=function(t){return!!t.spansTime(Math.ceil(this._canvasClockTime)+this._rangeSpanPadding)},e.prototype._rangeNavigable=function(t){var e=t.getBehavior();return!e||"no-nav"!==e.toString()},e.prototype._render=function(){if(this.isVirtual()&&m.AVComponent.newRanges&&this.isVisible()){console.groupCollapsed("Rendering a new range!"),console.log({dataRange:this._data.rangeId,range:this.currentRange,newLimitToRange:this.limitToRange,constraintToRange:this._data.constrainNavigationToRange,autoSelectRange:this._data.autoSelectRange}),this.limitToRange&&this.currentRange?(console.log("Selecting plan...",this.currentRange),this.timePlanPlayer.selectPlan({rangeId:this.currentRange})):(console.log("Resetting..."),this.timePlanPlayer.selectPlan({reset:!0}));var t=this._$canvasTimelineContainer.width()/this.timePlanPlayer.getDuration();this._$durationHighlight.show();var e=this.timePlanPlayer.getCurrentRange(),n=e.start,i=e.duration;return this._$canvasTimelineContainer.slider({value:this._canvasClockTime-this.timePlanPlayer.plan.start,max:this.timePlanPlayer.getDuration()}),this._$durationHighlight.css({left:n*t,width:i*t}),console.groupEnd(),this._updateCurrentTimeDisplay(),this._updateDurationDisplay(),void this._drawWaveform()}if(this._data.limitToRange&&this._data.range?(this._$canvasTimelineContainer.hide(),this._$rangeTimelineContainer.show()):(this._$canvasTimelineContainer.show(),this._$rangeTimelineContainer.hide()),this._data.range||this._$durationHighlight.hide(),this.isVisible()&&(this.isOnlyCanvasInstance||this.isVirtual())){if(this._data.range&&(!this.isVirtual()||!m.AVComponent.newRanges))if(i=this._data.range.getDuration()){var r=this._getDuration(),a=r*(t=this._$canvasTimelineContainer.width()/r),o=(n=i.start*t,i.end*t);(o>a||o<n)&&(o=a);var s=o-n;this.isVirtual()||this.isOnlyCanvasInstance?(this._$durationHighlight.show(),this._$durationHighlight.css({left:n,width:s})):this._$durationHighlight.hide();var u=this;this._$rangeTimelineContainer.data("ui-sortable")&&this._$rangeTimelineContainer.slider("destroy"),this._$rangeTimelineContainer.slider({value:i.start,step:.01,orientation:"horizontal",range:"min",min:i.start,max:i.end,animate:!1,create:function(t,e){},slide:function(t,e){u._setCurrentTime(e.value)},stop:function(t,e){}})}this._updateCurrentTimeDisplay(),this._updateDurationDisplay(),this._drawWaveform()}},e.prototype.getCanvasId=function(){if(this._data&&this._data.canvas)return this._data.canvas.id},e.prototype._updateHoverPreview=function(t,e,n){var i=e.offset(),r=t.pageX-i.left,a=e.find(".arrow"),o=e.find(".hover-highlight"),s=e.find(".hover-preview");o.width(r);var u=e.width(),l=r/u,c=Math.min(n*l);s.find(".label").text(M.formatTime(c));var h=s.outerWidth(),p=s.outerHeight(),f=r-.5*h,d=.5*h-6;f<0&&(f=0,d=r-6),f+h>u&&(f=u-h,d=h-(u-r)-6),s.css({left:f,top:-1*p+"px"}).show(),a.css({left:d})},e.prototype._previous=function(t){if(m.AVComponent.newRanges&&this.isVirtual()){console.groupCollapsed("prev");var e=this.timePlanPlayer.previous();return this._setCurrentTime(e),console.log("new time -> ",e),void console.groupEnd()}this._data.limitToRange?t?this._isNavigationConstrainedToRange()?this._rewind():this.fire(g.CanvasInstanceEvents.PREVIOUS_RANGE):this._rewind():this._data.range?t?(this.set({range:void 0}),this._rewind()):this.fire(g.CanvasInstanceEvents.PREVIOUS_RANGE):this._rewind()},e.prototype._next=function(){if(m.AVComponent.newRanges&&this.isVirtual())return console.groupCollapsed("next"),this._setCurrentTime(this.timePlanPlayer.next(),!1),void console.groupEnd();this._data.limitToRange&&this._isNavigationConstrainedToRange()?this._fastforward():this.fire(g.CanvasInstanceEvents.NEXT_RANGE)},e.prototype.destroy=function(){window.clearInterval(this._highPriorityInterval),window.clearInterval(this._lowPriorityInterval),window.clearInterval(this._canvasClockInterval)},e.prototype._convertToPercentage=function(t,e){return t/e*100},e.prototype._renderMediaElement=function(t){var e,n=this;switch(t.type.toString().toLowerCase()){case"video":e=$('<video crossorigin="anonymous" class="anno" />');break;case"sound":case"audio":e=$('<audio crossorigin="anonymous" class="anno" />');break;default:return}var i=e[0];if(t.format&&"application/dash+xml"===t.format.toString()){e.attr("data-dashjs-player","");var r=dashjs.MediaPlayer().create();r.getDebug().setLogToBrowserConsole(!1),this._data.adaptiveAuthEnabled&&r.setXHRWithCredentialsForType("MPD",!0),r.initialize(i,t.source)}else if(t.format&&"application/vnd.apple.mpegurl"===t.format.toString())if(Hls.isSupported()){var a=new Hls;a=this._data.adaptiveAuthEnabled?new Hls({xhrSetup:function(t){t.withCredentials=!0}}):new Hls,this._data.adaptiveAuthEnabled,a.loadSource(t.source),a.attachMedia(i)}else i.canPlayType("application/vnd.apple.mpegurl")&&(i.src=t.source);else e.attr("src",t.source);e.css({top:t.top+"%",left:t.left+"%",width:t.width+"%",height:t.height+"%"}).hide(),t.element=e,t.timeout=null;var o=this;t.checkForStall=function(){var t=this;this.active?(o._checkMediaSynchronization(),this.element.get(0).readyState>0&&!this.outOfSync?o._playbackStalled(!1,t):(o._playbackStalled(!0,t),this.timeout&&window.clearTimeout(this.timeout),this.timeout=window.setTimeout((function(){t.checkForStall()}),1e3))):o._playbackStalled(!1,t)},this._contentAnnotations.push(t),this.$playerElement&&this._$canvasContainer.append(e),e.on("loadedmetadata",(function(){n._readyMediaCount++,n._readyMediaCount===n._contentAnnotations.length&&(n._data.autoPlay?n.play():n.pause(),n._updateDurationDisplay(),n.fire(T.Events.MEDIA_READY))})),e.attr("preload","metadata"),e.get(0).load(),this._renderSyncIndicator(t)},e.prototype._getWaveformData=function(t){return new Promise((function(e,n){$.ajax({url:t,type:"GET",dataType:"binary",responseType:"arraybuffer",processData:!1}).done((function(t){e(WaveformData.create(t))})).fail((function(){n(new Error("Network Error"))}))}))},e.prototype._renderWaveform=function(t){var e=this;if(void 0===t&&(t=!1),(!this.waveFormInit||t)&&(this.waveFormInit=!0,this.waveforms.length)){var n=this.waveforms.map((function(t){return e._getWaveformData(t)}));Promise.all(n).then((function(t){e._waveformCanvas=document.createElement("canvas"),e._waveformCanvas.classList.add("waveform"),e._$canvasContainer.append(e._waveformCanvas),e.waveformPageX=e._waveformCanvas.getBoundingClientRect().left;var n=e._drawWaveform.bind(e);e._waveformCanvas.addEventListener("mousein",(function(){e.waveformDeltaX=0})),e._$canvasTimelineContainer.on("mouseout",(function(){e.waveformDeltaX=0,requestAnimationFrame(n)})),e._waveformCanvas.addEventListener("mouseout",(function(){e.waveformDeltaX=0,requestAnimationFrame(n)})),e._waveformCanvas.addEventListener("mousemove",(function(t){e.waveformDeltaX=t.clientX-e.waveformPageX,requestAnimationFrame(n)})),e._$canvasTimelineContainer.on("mousemove",(function(t){e.waveformDeltaX=t.clientX-e.waveformPageX,requestAnimationFrame(n)})),e._waveformCanvas.addEventListener("click",(function(){var t=e._waveformCanvas.getBoundingClientRect().width||0;if(t){var n=e.getRangeTiming(),i=n.start,r=n.duration;e._setCurrentTime(i+r*(e.waveformDeltaX/t))}})),e._waveformCtx=e._waveformCanvas.getContext("2d"),e._waveformCtx&&(e._waveformCtx.fillStyle=e._data.waveformColor||"#fff",e._compositeWaveform=new E.CompositeWaveform(t),e.fire(T.Events.WAVEFORM_READY))})).catch((function(){console.warn("Could not load wave forms.")}))}},e.prototype.getRangeTiming=function(){if(m.AVComponent.newRanges&&this.isVirtual())return{start:this.timePlanPlayer.plan.start,end:this.timePlanPlayer.plan.end,duration:this.timePlanPlayer.plan.duration,percent:Math.min((this.timePlanPlayer.getTime()-this.timePlanPlayer.plan.start)/this.timePlanPlayer.plan.duration,1)};var t,e=0,n=this._compositeWaveform?this._compositeWaveform.duration:-1,i=n;return this._data.range&&(t=this._data.range.getDuration()),this.isVirtual()||(n=this._getDuration()),this._data.limitToRange&&t&&(e=t.start,i=(n=t.end)-e),-1===n&&t&&(e=t.start,i=(n=t.end)-e),-1===n&&(console.log("getRangeTiming",{start:e,end:n,duration:i,durationObj:t}),console.log("Duration not found...")),{start:e,end:n,duration:n-e,percent:Math.min((this.getClockTime()-e)/i,1)}},e.prototype._drawWaveform=function(){if(this._renderWaveform(),this._waveformCtx&&this.isVisible()){var t=this.getRangeTiming(),e=t.start,n=t.end,i=t.percent,r=e*this._compositeWaveform.pixelsPerSecond,a=n*this._compositeWaveform.pixelsPerSecond,o=this._waveformCtx.canvas.width,s=this._waveformCtx.canvas.height,u=this._data.waveformBarSpacing,l=this._data.waveformBarWidth,c=Math.floor((a-r)/o*u),h=o/u;this._waveformCtx.clearRect(0,0,o,s),this._waveformCtx.fillStyle=this._data.waveformColor||"#fff";var p=o/(n-e),f=[];if(this._contentAnnotations)for(var d=0;d<this._contentAnnotations.length;d++){var v=this._contentAnnotations[d];if(v&&v.element){var _=v.element[0],g=v.startOffest||0;if(v.active)for(var y=0;y<_.buffered.length;y++){var E=_.buffered.length-y-1,T=_.buffered.start(E),C=_.buffered.end(E);f.push([(g+T-e)*p,(g+C-e)*p])}}}var I=[];if(this.isVirtual()&&m.AVComponent.newRanges)for(var P=this.timePlanPlayer.plan,w=this._data.canvas,O=0,M=P.stops;O<M.length;O++){var R=M[O],A=w.durationMap[P.canvases[R.canvasIndex]],S=A.runningDuration-A.duration;I.push({start:(R.start-P.start)/P.duration,end:(R.end-P.start)/P.duration,duration:R.duration,startTime:S+R.canvasTime.start,endTime:S+R.canvasTime.start+R.canvasTime.end})}else I.push({start:0,duration:n-e,end:n,startTime:e});for(var L=0,x=r;x<a;x+=c){var N=b.normalise(x,r,a),D=N*o;I[L].end<N&&L++;var V=I[L],j=N-V.start,U=Math.floor((V.startTime+j*V.duration)*this._compositeWaveform.pixelsPerSecond),F=this._getWaveformMaxAndMin(this._compositeWaveform,U,h),$=this._scaleY(F.max-F.min,s),k=D/o<i,G=this.waveformDeltaX/o,H=this._data.waveformColor||"#fff",B=(s-$)/2;if(k)H=0===this.waveformDeltaX?"#14A4C3":D/o<G?"#11758e":"#14A4C3";else if(D/o<G)H="#86b3c3";else{H="#8a9aa1";for(var W=0,z=f;W<z.length;W++){var Y=z[W],X=Y[0],q=Y[1];if(D>X&&D<q){H="#fff";break}}}this._waveformCtx.fillStyle=H,this._waveformCtx.fillRect(D,B,l,0|$)}}},e.prototype._getWaveformMaxAndMin=function(t,e,n){for(var i=-127,r=128,a=e;a<e+n;a++){var o=t.max(a),s=t.min(a);o>i&&(i=o),s<r&&(r=s)}return{max:i,min:r}},e.prototype.isLimitedToRange=function(){return this._data.limitToRange},e.prototype.hasCurrentRange=function(){return!!this._data.range},e.prototype._updateCurrentTimeDisplay=function(){var t;if(m.AVComponent.newRanges&&this.isVirtual())this._$canvasTime.text(M.formatTime(this._canvasClockTime-this.timePlanPlayer.getStartTime()));else if(this._data.range&&(t=this._data.range.getDuration()),this._data.limitToRange&&t){var e=this._canvasClockTime-t.start;this._$canvasTime.text(M.formatTime(e))}else this._$canvasTime.text(M.formatTime(this._canvasClockTime))},e.prototype._updateDurationDisplay=function(){var t;m.AVComponent.newRanges&&this.isVirtual()?this._$canvasDuration.text(M.formatTime(this.timePlanPlayer.getDuration())):(this._data.range&&(t=this._data.range.getDuration()),this._data.limitToRange&&t?this._$canvasDuration.text(M.formatTime(t.getLength())):this._$canvasDuration.text(M.formatTime(this._getDuration())))},e.prototype._renderSyncIndicator=function(t){if(m.AVComponent.newRanges&&this.isVirtual())console.log("_renderSyncIndicator");else{var e=this._convertToPercentage(t.start,this._getDuration()),n=this._convertToPercentage(t.end-t.start,this._getDuration()),i=$('<div class="timeline-item"></div>');i.css({left:e+"%",width:n+"%"});var r=$('<div class="line-wrapper"></div>');i.appendTo(r),t.timelineElement=i,this.$playerElement&&this._$timelineItemContainer.append(r)}},e.prototype.setCurrentTime=function(t){return console.log("External set current time?"),this._setCurrentTime(t,!1)},e.prototype._setCurrentTime=function(t,e){return void 0===e&&(e=!0),a(this,void 0,void 0,(function(){var n,i,r;return o(this,(function(a){switch(a.label){case 0:return m.AVComponent.newRanges&&this.isVirtual()?(this._buffering=!0,[4,this.timePlanPlayer.setTime(t,e)]):[3,2];case 1:return a.sent(),this._buffering=!1,this._canvasClockStartDate=Date.now()-1e3*this._canvasClockTime,this._canvasClockUpdater(),this._highPriorityUpdater(),this._lowPriorityUpdater(),this._synchronizeMedia(),[2];case 2:return n=this.getRangeTiming(),i=n.start,r=n.end,t<i||i>r?[2]:(this._canvasClockTime=t,this._canvasClockStartDate=Date.now()-1e3*this._canvasClockTime,this.logMessage("SET CURRENT TIME to: "+this._canvasClockTime+" seconds."),this._canvasClockUpdater(),this._highPriorityUpdater(),this._lowPriorityUpdater(),this._synchronizeMedia(),[2])}}))}))},e.prototype._rewind=function(t){var e;m.AVComponent.newRanges&&this.isVirtual()?console.log("Rewind"):(this.pause(),this._data.range&&(e=this._data.range.getDuration()),this._data.limitToRange&&e?this._setCurrentTime(e.start):this._setCurrentTime(0),this._data.limitToRange||this._data&&this._data.helper&&this.set({range:void 0}))},e.prototype._fastforward=function(){var t;m.AVComponent.newRanges&&this.isVirtual()?console.log("Fast forward"):(this._data.range&&(t=this._data.range.getDuration()),this._data.limitToRange&&t?this._canvasClockTime=t.end:this._canvasClockTime=this._getDuration(),this.pause())},e.prototype.play=function(t){return a(this,void 0,void 0,(function(){var e,n,i=this;return o(this,(function(r){switch(r.label){case 0:return this._isPlaying?[2]:m.AVComponent.newRanges&&this.isVirtual()?this.timePlanPlayer.hasEnded()?(this._buffering=!0,[4,this.timePlanPlayer.setTime(this.timePlanPlayer.currentStop.start)]):[3,2]:[3,3];case 1:r.sent(),this._buffering=!1,r.label=2;case 2:return this.timePlanPlayer.play(),[3,4];case 3:e=void 0,this._data.range&&(e=this._data.range.getDuration()),this._data.limitToRange&&e&&this._canvasClockTime>=e.end&&(this._canvasClockTime=e.start),this._canvasClockTime===this._getDuration()&&(this._canvasClockTime=0),r.label=4;case 4:return this._canvasClockStartDate=Date.now()-1e3*this._canvasClockTime,this._highPriorityInterval&&clearInterval(this._highPriorityInterval),this._highPriorityInterval=window.setInterval((function(){i._highPriorityUpdater()}),this._highPriorityFrequency),this._lowPriorityInterval&&clearInterval(this._lowPriorityInterval),this._lowPriorityInterval=window.setInterval((function(){i._lowPriorityUpdater()}),this._lowPriorityFrequency),this._canvasClockInterval&&clearInterval(this._canvasClockInterval),this._canvasClockInterval=window.setInterval((function(){i._canvasClockUpdater()}),this._canvasClockFrequency),this._isPlaying=!0,t||this._synchronizeMedia(),n=this._data&&this._data.content?this._data.content.pause:"",this._$playButton.prop("title",n),this._$playButton.find("i").switchClass("play","pause"),this.fire(g.CanvasInstanceEvents.PLAYCANVAS),this.logMessage("PLAY canvas"),[2]}}))}))},e.prototype.pause=function(t){window.clearInterval(this._highPriorityInterval),window.clearInterval(this._lowPriorityInterval),window.clearInterval(this._canvasClockInterval),this._isPlaying=!1,t||(this._highPriorityUpdater(),this._lowPriorityUpdater(),this._synchronizeMedia()),m.AVComponent.newRanges&&this.isVirtual()&&this.timePlanPlayer.pause();var e=this._data&&this._data.content?this._data.content.play:"";this._$playButton.prop("title",e),this._$playButton.find("i").switchClass("pause","play"),this.fire(g.CanvasInstanceEvents.PAUSECANVAS),this.logMessage("PAUSE canvas")},e.prototype._isNavigationConstrainedToRange=function(){return this._data.constrainNavigationToRange||!1},e.prototype._canvasClockUpdater=function(){if(m.AVComponent.newRanges&&this.isVirtual()){if(this._buffering)return;this.timePlanPlayer.advanceToTime((Date.now()-this._canvasClockStartDate)/1e3).paused&&this.pause()}else{var t;if(!this._buffering)this._canvasClockTime=(Date.now()-this._canvasClockStartDate)/1e3,this._data.range&&(t=this._data.range.getDuration()),this._data.limitToRange&&t&&this._canvasClockTime>=t.end&&this.pause(),this._canvasClockTime>=this._getDuration()&&(this._canvasClockTime=this._getDuration(),this.pause())}},e.prototype._highPriorityUpdater=function(){this._bufferShown&&!this._buffering&&(this.$playerElement.removeClass("player--loading"),this._bufferShown=!1),this._buffering&&!this._bufferShown&&(this.$playerElement.addClass("player--loading"),this._bufferShown=!0),m.AVComponent.newRanges&&this.isVirtual()?(this._$rangeTimelineContainer.slider({value:this._canvasClockTime-this.timePlanPlayer.plan.start}),this._$canvasTimelineContainer.slider({value:this._canvasClockTime-this.timePlanPlayer.plan.start})):(this._$rangeTimelineContainer.slider({value:this._canvasClockTime}),this._$canvasTimelineContainer.slider({value:this._canvasClockTime})),this._updateCurrentTimeDisplay(),this._updateDurationDisplay(),this._drawWaveform()},e.prototype._lowPriorityUpdater=function(){this._updateMediaActiveStates(),this._data.autoSelectRange&&(this.isVirtual()||this.isOnlyCanvasInstance)&&this._hasRangeChanged()},e.prototype._updateMediaActiveStates=function(){if(m.AVComponent.newRanges&&this.isVirtual()){if(this._isPlaying){if(this.timePlanPlayer.isBuffering())return void(this._buffering=!0);this._buffering&&(this._buffering=!1),this.timePlanPlayer.advanceToTime(this._canvasClockTime)}}else for(var t,e=0;e<this._contentAnnotations.length;e++)(t=this._contentAnnotations[e]).start<=this._canvasClockTime&&t.end>=this._canvasClockTime?(this._checkMediaSynchronization(),t.active||(this._synchronizeMedia(),t.active=!0,t.element.show(),t.timelineElement.addClass("active")),t.element[0].currentTime>t.element[0].duration-t.endOffset&&this._pauseMedia(t.element[0])):t.active&&(t.active=!1,t.element.hide(),t.timelineElement.removeClass("active"),this._pauseMedia(t.element[0]))},e.prototype._pauseMedia=function(t){t.pause()},e.prototype._setMediaCurrentTime=function(t,e){isNaN(t.duration)||(t.currentTime=e)},e.prototype._synchronizeMedia=function(){if(!m.AVComponent.newRanges||!this.isVirtual()){for(var t,e=0;e<this._contentAnnotations.length;e++){if(t=this._contentAnnotations[e],this._setMediaCurrentTime(t.element[0],this._canvasClockTime-t.start+t.startOffset),t.start<=this._canvasClockTime&&t.end>=this._canvasClockTime)if(this._isPlaying){if(t.element[0].paused){var n=t.element[0].play();n&&n.catch((function(){}))}}else this._pauseMedia(t.element[0]);else this._pauseMedia(t.element[0]);t.element[0].currentTime>t.element[0].duration-t.endOffset&&this._pauseMedia(t.element[0])}this.logMessage("SYNC MEDIA at: "+this._canvasClockTime+" seconds.")}},e.prototype._checkMediaSynchronization=function(){if(m.AVComponent.newRanges&&this.isVirtual())this._isPlaying&&(this.timePlanPlayer.isBuffering()?this._buffering=!0:this._buffering&&(this._buffering=!1));else for(var t,e=0,n=this._contentAnnotations.length;e<n;e++)if((t=this._contentAnnotations[e]).start<=this._canvasClockTime&&t.end>=this._canvasClockTime){this._isPlaying&&(t.element[0].readyState<3?this._buffering=!0:this._buffering&&(this._buffering=!1));var i=this._canvasClockTime-t.start+t.startOffset,r=t.element[0].currentTime;if(Math.abs(r-i)>this._mediaSyncMarginSecs){t.outOfSync=!0;var a=Math.abs(r-i);this.logMessage("DETECTED synchronization lag: "+Math.abs(a)),this._setMediaCurrentTime(t.element[0],i)}else t.outOfSync=!1}},e.prototype._playbackStalled=function(t,e){if(t)this._stallRequestedBy.indexOf(e)<0&&this._stallRequestedBy.push(e),this._isStalled||(this.$playerElement,this._wasPlaying=this._isPlaying,this.pause(!0),this._isStalled=t);else{var n=this._stallRequestedBy.indexOf(e);n>=0&&this._stallRequestedBy.splice(n,1),0===this._stallRequestedBy.length&&(this._isStalled&&this._wasPlaying&&this.play(!0),this._isStalled=t)}},e.prototype.resize=function(){if(this.$playerElement){var t=this._$canvasContainer.width();if(t){this._$canvasTimelineContainer.width(t);var e=this.$playerElement.find(".options-container");void 0!==this._data.halveAtWidth&&this.$playerElement.parent().width()<this._data.halveAtWidth?this._$canvasContainer.height(this.$playerElement.parent().height()/2):this._$canvasContainer.height(this.$playerElement.parent().height()-e.height())}if(this._waveformCanvas){var n=this._$canvasContainer.width(),i=this._$canvasContainer.height();this._waveformCanvas.width=n,this._waveformCanvas.height=i,this.waveformPageX=this._waveformCanvas.getBoundingClientRect().left}this._render(),this._drawWaveform()}},e}(u.BaseComponent);e.CanvasInstance=L},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=n(7),r=n(9),a=n(10),o=n(11);e.extractMediaFromAnnotationBodies=function(t){var e=t.getBody();if(!e.length)return null;for(var n=0;n<e.length;n++){if((u=(s=e[n]).getFormat())&&i.isHLSFormat(u)&&a.canPlayHls())return s}for(n=0;n<e.length;n++){if((u=(s=e[n]).getFormat())&&r.isMpegDashFormat(u)&&!o.isSafari())return s}for(n=0;n<e.length;n++){var s,u;if((u=(s=e[n]).getFormat())&&!i.isHLSFormat(u)&&!r.isMpegDashFormat(u))return s}return null}},function(t,e,n){"use strict";var i,r=this&&this.__extends||(i=function(t,e){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(t,e)},function(t,e){function n(){this.constructor=t}i(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)});Object.defineProperty(e,"__esModule",{value:!0});var a=n(4),o=n(1),s=function(t){function e(e){var n=t.call(this,e)||this;return n._lastVolume=1,n._data={volume:1},n._init(),n._resize(),n}return r(e,t),e.prototype._init=function(){var e=this,n=t.prototype._init.call(this);this._$element=$(this.el),n||console.error("Component failed to initialise"),this._$volumeMute=$('\n      <button class="btn volume-mute" title="'+this.options.data.content.mute+'">\n          <i class="av-icon av-icon-mute on" aria-hidden="true"></i>'+this.options.data.content.mute+"\n      </button>\n    "),this._$volumeSlider=$('<div class="volume-slider"></div>'),this._$element.append(this._$volumeMute,this._$volumeSlider);var i=this;return this._$volumeMute.on("touchstart click",(function(t){t.preventDefault(),0!==e._data.volume?(e._lastVolume=e._data.volume,e._data.volume=0):e._data.volume=e._lastVolume,e.fire(o.VolumeEvents.VOLUME_CHANGED,e._data.volume)})),this._$volumeSlider.slider({value:i._data.volume,step:.1,orientation:"horizontal",range:"min",min:0,max:1,animate:!1,create:function(){},slide:function(t,e){i._data.volume=e.value,0===i._data.volume&&(i._lastVolume=0),i.fire(o.VolumeEvents.VOLUME_CHANGED,i._data.volume)},stop:function(t,e){}}),n},e.prototype.set=function(t){this._data=Object.assign(this._data,t),this._render()},e.prototype._render=function(){if(void 0!==this._data.volume)if(this._$volumeSlider.slider({value:this._data.volume}),0===this._data.volume){var t=this.options.data.content.unmute;this._$volumeMute.prop("title",t),this._$volumeMute.find("i").switchClass("on","off")}else{t=this.options.data.content.mute;this._$volumeMute.prop("title",t),this._$volumeMute.find("i").switchClass("off","on")}},e.prototype._resize=function(){},e}(a.BaseComponent);e.AVVolumeControl=s},function(t,e,n){"use strict";var i=this&&this.__assign||function(){return(i=Object.assign||function(t){for(var e,n=1,i=arguments.length;n<i;n++)for(var r in e=arguments[n])Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t}).apply(this,arguments)},r=this&&this.__spreadArrays||function(){for(var t=0,e=0,n=arguments.length;e<n;e++)t+=arguments[e].length;var i=Array(t),r=0;for(e=0;e<n;e++)for(var a=arguments[e],o=0,s=a.length;o<s;o++,r++)i[r]=a[o];return i};Object.defineProperty(e,"__esModule",{value:!0}),e.createTimePlansFromManifest=function(t,e){var n=function(e,a,o){var s,u,l;void 0===a&&(a=[]),void 0===o&&(o=0);for(var c={type:"time-plan",canvases:[],duration:0,items:[],stops:[],rangeOrder:[e.id],end:0,start:o,rangeId:e.id,rangeStack:a},h=o,p=r(e.items,e.getCanvasIds()),f=0;f<p.length;f++){var d=p[f];if("string"==typeof d){var v=d.match(/(.*)#t=([0-9.]+),?([0-9.]+)?/)||[void 0,d,"0","0"],_=v[1],g=v[2],m=v[3];if(!_||void 0===g||void 0===m)continue;var y=t.getSequenceByIndex(0).getCanvasById(_);if(null===y)throw new Error("Canvas not found..");c.canvases.push(y.id);var E=parseFloat(g||"0"),T=parseFloat(m||"0"),C=T-E,I={type:"time-stop",canvasIndex:f,start:(h+=C)-C,end:h,duration:C,rangeId:e.id,rawCanvasSelector:d,canvasTime:{start:E,end:T},rangeStack:a};c.stops.push(I),c.items.push(I)}else{var P=d.getBehavior();if(!P||"no-nav"!==P){var w=n(d,r(a,[d.id]),h);h+=w.duration,(s=c.stops).push.apply(s,w.stops.map((function(t){return i(i({},t),{canvasIndex:t.canvasIndex+c.canvases.length})}))),(u=c.canvases).push.apply(u,w.canvases),c.items.push(w),(l=c.rangeOrder).push.apply(l,w.rangeOrder)}}}return c.end=h,c.duration=c.end-c.start,c},a=t.getTopRanges(),o=[];a||(a=t.getAllRanges()),1!==a.length||a[0].id||(a=a[0].getRanges());for(var s=0,u=a;s<u.length;s++){var l=u[s];l.getRanges()[0]&&l.id===l.getRanges()[0].id&&(l=l.getRanges()[0]);var c=n(l,[l.id]);o.push(c)}return o[0]}},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=n(0),r=n(12);e.getMediaSourceFromAnnotationBody=function(t,e,n){var a=e.getType(),o=e.getFormat()||void 0,s=e.id.split("#")[0],u=t.getTarget();if(!u)throw new Error("No target");if(!a)throw new Error("Unknown media type");var l=r.getSpatialComponent(u)||[0,0,n.width||0,n.height||0],c=l[0],h=l[1],p=l[2],f=l[3],d=i.Utils.getTemporalComponent(u)||[0,n.duration],v=d[0],_=d[1],g=e.id.match(/(.*)#t=([0-9.]+),?([0-9.]+)?/)||[void 0,e.id,void 0,void 0],m=g[1],y=g[2],E=g[3];return{type:a,format:o,mediaSource:s,canvasId:n.id,x:c,y:h,width:void 0===p?void 0:parseInt(String(p),10),height:void 0===f?void 0:parseInt(String(f),10),start:Number(Number(v).toFixed(2)),end:Number(Number(_).toFixed(2)),bodyId:m,offsetStart:void 0===y?void 0:parseFloat(y),offsetEnd:void 0===E?void 0:parseFloat(E)}}},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.formatTime=function(t){var e,n,i;return i=Math.ceil(t),((e=(e=Math.floor(i/3600))>=10?e:"0"+e)>=1?e+":":"")+(n=(n=Math.floor(i%3600/60))>=10?n:"0"+n)+":"+(i=(i=Math.floor(i%3600%60))>=10?i:"0"+i)}},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.normalise=function(t,e,n){return(t-e)/(n-e)}},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=n(5);e.isVirtual=function(t){return!!t&&t instanceof i.VirtualCanvas}},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=n(0);e.getFirstTargetedCanvasId=function t(e){var n;if(e.canvases&&e.canvases.length)n=e.canvases[0];else{var r=e.getRanges();if(r.length)return t(r[0])}if(void 0!==n)return i.Utils.normaliseUrl(n)}},function(t,e,n){t.exports=n(27)},function(t,e,n){"use strict";function i(t){for(var n in t)e.hasOwnProperty(n)||(e[n]=t[n])}Object.defineProperty(e,"__esModule",{value:!0}),i(n(15)),i(n(17)),i(n(19)),i(n(36)),i(n(13)),i(n(3)),i(n(1))},function(t,e,n){"use strict";var i=this&&this.__awaiter||function(t,e,n,i){return new(n||(n=Promise))((function(r,a){function o(t){try{u(i.next(t))}catch(t){a(t)}}function s(t){try{u(i.throw(t))}catch(t){a(t)}}function u(t){var e;t.done?r(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(o,s)}u((i=i.apply(t,e||[])).next())}))},r=this&&this.__generator||function(t,e){var n,i,r,a,o={label:0,sent:function(){if(1&r[0])throw r[1];return r[1]},trys:[],ops:[]};return a={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a;function s(a){return function(s){return function(a){if(n)throw new TypeError("Generator is already executing.");for(;o;)try{if(n=1,i&&(r=2&a[0]?i.return:a[0]?i.throw||((r=i.return)&&r.call(i),0):i.next)&&!(r=r.call(i,a[1])).done)return r;switch(i=0,r&&(a=[2&a[0],r.value]),a[0]){case 0:case 1:r=a;break;case 4:return o.label++,{value:a[1],done:!1};case 5:o.label++,i=a[1],a=[0];continue;case 7:a=o.ops.pop(),o.trys.pop();continue;default:if(!(r=o.trys,(r=r.length>0&&r[r.length-1])||6!==a[0]&&2!==a[0])){o=0;continue}if(3===a[0]&&(!r||a[1]>r[0]&&a[1]<r[3])){o.label=a[1];break}if(6===a[0]&&o.label<r[1]){o.label=r[1],r=a;break}if(r&&o.label<r[2]){o.label=r[2],o.ops.push(a);break}r[2]&&o.ops.pop(),o.trys.pop();continue}a=e.call(t,o)}catch(t){a=[6,t],i=0}finally{n=r=0}if(5&a[0])throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}([a,s])}}};Object.defineProperty(e,"__esModule",{value:!0});var a=n(29),o=n(30),s=n(31),u=n(32),l=function(){function t(t,e){switch(void 0===e&&(e={}),this.source=t,this.mediaSource=t.mediaSource,this.type=t.type.toString().toLowerCase(),this.format=t.format?t.format.toString():void 0,this.mediaSyncMarginSecs=e.mediaSyncMarginSecs||1,this.type){case"video":this.element=document.createElement("video");break;case"sound":case"audio":this.element=document.createElement("audio");break;default:return}this.isDash()?this.instance=new a.DashFormat(this.mediaSource,e):this.isHls()?this.instance=new o.HlsFormat(this.mediaSource,e):this.isMpeg()?this.instance=new s.MpegFormat(this.mediaSource,e):this.instance=new u.DefaultFormat(this.mediaSource,e),this.element.classList.add("anno"),this.element.crossOrigin="anonymous",this.element.preload="metadata",this.element.pause(),this.instance.attachTo(this.element),this.element.currentTime=this.source.start}return t.prototype.syncClock=function(t){Math.abs(this.element.currentTime-t)>this.mediaSyncMarginSecs&&(this.element.currentTime=t)},t.prototype.getCanvasId=function(){return this.source.canvasId},t.prototype.isWithinRange=function(t){return this.source.start<=t&&this.source.end>=t},t.prototype.load=function(t){return void 0===t&&(t=!1),i(this,void 0,void 0,(function(){var e=this;return r(this,(function(n){switch(n.label){case 0:return t&&this.element.load(),[4,new Promise((function(t){e.element.addEventListener("loadedmetadata",(function(){t()}))}))];case 1:return n.sent(),[2]}}))}))},t.prototype.setSize=function(t,e,n,i){$(this.element).css({top:t+"%",left:e+"%",width:n+"%",height:i+"%"})},t.prototype.isDash=function(){return this.format&&"application/dash+xml"===this.format.toString()},t.prototype.isHls=function(){return this.format&&"application/vnd.apple.mpegurl"===this.format.toString()&&Hls&&Hls.isSupported()},t.prototype.isMpeg=function(){return""!==this.element.canPlayType("application/vnd.apple.mpegurl")},t.prototype.stop=function(){this.element.pause(),this.element.currentTime=this.source.start},t.prototype.play=function(t){return t&&(this.element.currentTime=t),this.element.play()},t.prototype.pause=function(){this.element.pause()},t.prototype.isBuffering=function(){return this.element.readyState<3},t}();e.MediaElement=l},function(t,e,n){"use strict";var i,r=this&&this.__extends||(i=function(t,e){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(t,e)},function(t,e){function n(){this.constructor=t}i(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)});Object.defineProperty(e,"__esModule",{value:!0});var a=function(t){function e(e,n){void 0===n&&(n={});var i=t.call(this,e,n)||this;return i.player=dashjs.MediaPlayer().create(),i.player.getDebug().setLogToBrowserConsole(!1),n.adaptiveAuthEnabled&&i.player.setXHRWithCredentialsForType("MPD",!0),i}return r(e,t),e.prototype.attachTo=function(t){this.player.initialize(t,this.source,!1)},e.prototype.debug=function(){this.player.getDebug().setLogToBrowserConsole(!0),this.player.getDebug().setLogLevel(4)},e}(n(2).MediaFormat);e.DashFormat=a},function(t,e,n){"use strict";var i,r=this&&this.__extends||(i=function(t,e){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(t,e)},function(t,e){function n(){this.constructor=t}i(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)});Object.defineProperty(e,"__esModule",{value:!0});var a=function(t){function e(e,n){void 0===n&&(n={});var i=t.call(this,e,n)||this;return n.adaptiveAuthEnabled?i.hls=new Hls({xhrSetup:function(t){t.withCredentials=!0}}):i.hls=new Hls,i.hls.loadSource(i.source),i}return r(e,t),e.prototype.attachTo=function(t){this.hls.attachMedia(t)},e}(n(2).MediaFormat);e.HlsFormat=a},function(t,e,n){"use strict";var i,r=this&&this.__extends||(i=function(t,e){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(t,e)},function(t,e){function n(){this.constructor=t}i(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)});Object.defineProperty(e,"__esModule",{value:!0});var a=function(t){function e(e,n){return void 0===n&&(n={}),t.call(this,e,n)||this}return r(e,t),e.prototype.attachTo=function(t){t.src=this.source},e}(n(2).MediaFormat);e.MpegFormat=a},function(t,e,n){"use strict";var i,r=this&&this.__extends||(i=function(t,e){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(t,e)},function(t,e){function n(){this.constructor=t}i(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)});Object.defineProperty(e,"__esModule",{value:!0});var a=function(t){function e(e,n){return void 0===n&&(n={}),t.call(this,e,n)||this}return r(e,t),e}(n(2).MediaFormat);e.DefaultFormat=a},function(t,e,n){"use strict";var i=this&&this.__awaiter||function(t,e,n,i){return new(n||(n=Promise))((function(r,a){function o(t){try{u(i.next(t))}catch(t){a(t)}}function s(t){try{u(i.throw(t))}catch(t){a(t)}}function u(t){var e;t.done?r(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(o,s)}u((i=i.apply(t,e||[])).next())}))},r=this&&this.__generator||function(t,e){var n,i,r,a,o={label:0,sent:function(){if(1&r[0])throw r[1];return r[1]},trys:[],ops:[]};return a={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a;function s(a){return function(s){return function(a){if(n)throw new TypeError("Generator is already executing.");for(;o;)try{if(n=1,i&&(r=2&a[0]?i.return:a[0]?i.throw||((r=i.return)&&r.call(i),0):i.next)&&!(r=r.call(i,a[1])).done)return r;switch(i=0,r&&(a=[2&a[0],r.value]),a[0]){case 0:case 1:r=a;break;case 4:return o.label++,{value:a[1],done:!1};case 5:o.label++,i=a[1],a=[0];continue;case 7:a=o.ops.pop(),o.trys.pop();continue;default:if(!(r=o.trys,(r=r.length>0&&r[r.length-1])||6!==a[0]&&2!==a[0])){o=0;continue}if(3===a[0]&&(!r||a[1]>r[0]&&a[1]<r[3])){o.label=a[1];break}if(6===a[0]&&o.label<r[1]){o.label=r[1],r=a;break}if(r&&o.label<r[2]){o.label=r[2],o.ops.push(a);break}r[2]&&o.ops.pop(),o.trys.pop();continue}a=e.call(t,o)}catch(t){a=[6,t],i=0}finally{n=r=0}if(5&a[0])throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}([a,s])}}},a=this&&this.__spreadArrays||function(){for(var t=0,e=0,n=arguments.length;e<n;e++)t+=arguments[e].length;var i=Array(t),r=0;for(e=0;e<n;e++)for(var a=arguments[e],o=0,s=a.length;o<s;o++,r++)i[r]=a[o];return i};Object.defineProperty(e,"__esModule",{value:!0});var o=function(){function t(t,e,n,i,r){var a=this;this.continuous=!0,this.playing=!1,this._time=0,this.media=t,this.plan=e,this.fullPlan=e,this.currentStop=e.stops[0],this.notifyRangeChange=n,this.notifyTimeChange=i,this.notifyPlaying=r,this.logging=!0,this.currentRange=this.currentStop.rangeStack[0],this.setTime(this.currentStop.start),t.onPlay((function(t,e,n){t===a.plan.canvases[a.currentStop.canvasIndex]?a.playing||a.notifyPlaying(!0):n.pause()})),t.onPause((function(t){t===a.plan.canvases[a.currentStop.canvasIndex]&&a.playing&&a.notifyPlaying(!1)}))}return t.prototype.selectPlan=function(t){var e=void 0===t?{}:t,n=e.reset,i=e.rangeId;if(n)return this.initialisePlan(this.fullPlan);if(i){for(var r=[],a=0,o=this.fullPlan.stops;a<o.length;a++){var s=o[a],u=s.rangeStack.indexOf(i);-1!==s.rangeStack.indexOf(i)&&(r=s.rangeStack.slice(1,u+1))}for(var l=this.fullPlan,c=0,h=r;c<h.length;c++)for(var p=h[c],f=0,d=l.items;f<d.length;f++){var v=d[f];if("time-plan"===v.type&&v.rangeId===p){l=v;break}}if(l)return this.initialisePlan(l)}},t.prototype.initialisePlan=function(t){this.plan=t},t.prototype.getCurrentRange=function(){for(var t=this.currentRange,e=this.currentRange===this.currentStop.rangeId,n=e?this.plan.stops:this.fullPlan.stops,i=[],r=[],a=0,o=n;a<o.length;a++){var s=o[a];e?s.rangeId===t&&(i.push(s.start),r.push(s.end)):-1!==s.rangeStack.indexOf(t)&&(i.push(s.start),r.push(s.end))}var u=Math.min.apply(Math,i),l=Math.max.apply(Math,r);return console.log("Range",{rangeId:t,isRangeWithStop:e,stopsToCheck:n,start:u-this.plan.start,end:l-this.plan.start,duration:l-u}),{start:u-this.plan.start,end:l-this.plan.start,duration:l-u}},t.prototype.getTime=function(){return this._time},t.prototype.setInternalTime=function(t){return this._time=t,this.notifyTimeChange(t),this._time},t.prototype.log=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.logging&&console.log.apply(console,a(["TimePlanPlayer"],t))},t.prototype.setContinuousPlayback=function(t){this.continuous=t},t.prototype.setIsPlaying=function(t){this.playing=t},t.prototype.play=function(){return this.log("Play",this.getTime()),this.setIsPlaying(!0),this.media.play(this.plan.canvases[this.currentStop.canvasIndex],this.currentMediaTime()),this.getTime()},t.prototype.currentMediaTime=function(){return this.getTime()-this.currentStop.start+this.currentStop.canvasTime.start},t.prototype.pause=function(){return this.log("Pause",this.getTime()),this.setIsPlaying(!1),this.media.pause(),this.getTime()},t.prototype.setVolume=function(t){this.media.setVolume(t)},t.prototype.findStop=function(t){for(var e=0,n=this.plan.stops;e<n.length;e++){var i=n[e];if(i.start-.001<=t&&i.end-.001>t)return i}if(this.plan.stops[this.plan.stops.length-1].end===t)return this.plan.stops[this.plan.stops.length-1]},t.prototype.setTime=function(t,e){return void 0===e&&(e=!0),i(this,void 0,void 0,(function(){var n;return r(this,(function(i){switch(i.label){case 0:return console.groupCollapsed("set time"),console.trace(),console.log("USER SET TIME",t,e),this.log("set time",{from:this.getTime(),to:t}),this.setInternalTime(t),(n=this.findStop(t))&&n!==this.currentStop?(e&&(this.currentRange=n.rangeId),[4,this.advanceToStop(this.currentStop,n)]):[3,2];case 1:i.sent(),i.label=2;case 2:return console.groupEnd(),[2]}}))}))},t.prototype.next=function(){for(var t=this.plan.rangeOrder.indexOf(this.currentRange),e=t>=0&&t===this.plan.rangeOrder.length-1?void 0:this.plan.rangeOrder.indexOf(this.currentRange)+1,n=void 0!==e?this.plan.rangeOrder[e]:void 0,i=this.plan.stops.indexOf(this.currentStop),r=0,a=void 0,o=!0;o;){if(r++,!(a=this.plan.stops[i+r])){o=!1;break}if(a.rangeId!==this.currentStop.rangeId){o=!1;break}}return this.playing&&a&&(n=a.rangeId),n&&a&&a.rangeId!==n?(this.playing||-1===this.currentStop.rangeStack.indexOf(n)&&-1!==a.rangeStack.indexOf(n)?(this.currentRange=this.playing?a.rangeId:n,this.setInternalTime(a.start),this.advanceToStop(this.currentStop,a,this.playing?a.rangeId:n)):(this.currentRange=n,this.setInternalTime(this.currentStop.start),this.advanceToStop(this.currentStop,this.currentStop,n)),this.getTime()):(a?(this.setInternalTime(a.start),this.currentRange=a.rangeId,this.advanceToStop(this.currentStop,a,a.rangeId)):this.setInternalTime(this.currentStop.end),this.getTime())},t.prototype.previous=function(){for(var t=0===this.plan.rangeOrder.indexOf(this.currentRange)?void 0:this.plan.rangeOrder.indexOf(this.currentRange)-1,e=void 0!==t?this.plan.rangeOrder[t]:void 0,n=this.plan.stops.indexOf(this.currentStop),i=this.plan.stops[n-1],r=-1,a=!0;a;){var o=this.plan.stops[n+r];if(r--,!o){a=!1;break}if(i.rangeId!==o.rangeId){a=!1;break}i=o}return this.playing&&i&&(e=i.rangeId),0===n?(this.setInternalTime(this.currentStop.start),e&&this.currentStop.rangeId!==e&&(this.currentRange=e,this.advanceToStop(this.currentStop,this.currentStop,e)),this.getTime()):!e||-1!==this.currentStop.rangeStack.indexOf(e)||-1===i.rangeStack.indexOf(e)&&i.rangeId!==e?e&&-1!==this.currentStop.rangeStack.indexOf(e)?(this.setInternalTime(this.currentStop.start),this.currentRange=e,this.advanceToStop(this.currentStop,this.currentStop,e),this.getTime()):this.getTime():(this.setInternalTime(i.start),this.currentRange=e,this.advanceToStop(this.currentStop,i,e),this.getTime())},t.prototype.setRange=function(t){if(console.log("setRange",t),t===this.currentRange)return this.getTime();if(this.currentRange=t,t===this.currentStop.rangeId)return this.getTime();for(var e=0,n=this.plan.stops;e<n.length;e++){var i=n[e];if(i.rangeId===t){this.setInternalTime(i.start),this.advanceToStop(this.currentStop,i,t);break}}for(var r=0,a=this.plan.stops;r<a.length;r++){var o=a[r];if(-1!==o.rangeStack.indexOf(t)){this.setInternalTime(o.start),this.advanceToStop(this.currentStop,o,t);break}}return this.getTime()},t.prototype.isBuffering=function(){return this.media.isBuffering()},t.prototype.advanceToTime=function(t){var e=this.findStop(t);return e&&this.currentStop!==e?(this.advanceToStop(this.currentStop,e),{buffering:this.isBuffering(),time:t}):(this.playing&&this.currentRange!==this.currentStop.rangeId&&(this.currentRange=this.currentStop.rangeId,console.log("Breaking here?"),this.notifyRangeChange(this.currentStop.rangeId,{from:this.currentStop,to:this.currentStop})),e?(this.setInternalTime(t),this.media.syncClock(this.currentMediaTime()),{time:t}):(this.pause(),this.setTime(this.currentStop.end),{paused:!0,buffering:this.isBuffering(),time:this.currentStop.end}))},t.prototype.hasEnded=function(){return this.currentStop.end===this.getTime()},t.prototype.advanceToStop=function(t,e,n){return i(this,void 0,void 0,(function(){var i;return r(this,(function(r){switch(r.label){case 0:return t===e?(n&&this.notifyRangeChange(n||e.rangeId,{to:e,from:t}),[2]):(this.log("advanceToStop",e.start),this.currentStop=e,i=this.media.seekTo(this.plan.canvases[e.canvasIndex],this.currentMediaTime()),this.notifyRangeChange(n||e.rangeId,{to:e,from:t}),[4,i]);case 1:return r.sent(),[2]}}))}))},t.prototype.getStartTime=function(){return this.plan.start},t.prototype.getDuration=function(){return this.plan.duration},t}();e.TimePlanPlayer=o},function(t,e,n){"use strict";var i=this&&this.__awaiter||function(t,e,n,i){return new(n||(n=Promise))((function(r,a){function o(t){try{u(i.next(t))}catch(t){a(t)}}function s(t){try{u(i.throw(t))}catch(t){a(t)}}function u(t){var e;t.done?r(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(o,s)}u((i=i.apply(t,e||[])).next())}))},r=this&&this.__generator||function(t,e){var n,i,r,a,o={label:0,sent:function(){if(1&r[0])throw r[1];return r[1]},trys:[],ops:[]};return a={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a;function s(a){return function(s){return function(a){if(n)throw new TypeError("Generator is already executing.");for(;o;)try{if(n=1,i&&(r=2&a[0]?i.return:a[0]?i.throw||((r=i.return)&&r.call(i),0):i.next)&&!(r=r.call(i,a[1])).done)return r;switch(i=0,r&&(a=[2&a[0],r.value]),a[0]){case 0:case 1:r=a;break;case 4:return o.label++,{value:a[1],done:!1};case 5:o.label++,i=a[1],a=[0];continue;case 7:a=o.ops.pop(),o.trys.pop();continue;default:if(!(r=o.trys,(r=r.length>0&&r[r.length-1])||6!==a[0]&&2!==a[0])){o=0;continue}if(3===a[0]&&(!r||a[1]>r[0]&&a[1]<r[3])){o.label=a[1];break}if(6===a[0]&&o.label<r[1]){o.label=r[1],r=a;break}if(r&&o.label<r[2]){o.label=r[2],o.ops.push(a);break}r[2]&&o.ops.pop(),o.trys.pop();continue}a=e.call(t,o)}catch(t){a=[6,t],i=0}finally{n=r=0}if(5&a[0])throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}([a,s])}}};Object.defineProperty(e,"__esModule",{value:!0});var a=function(){function t(t){var e=this;this.elements=[],this.playing=!1,this.canvasMap={},this._onPlay=[],this._onPause=[],this.elements=t;for(var n=function(t){var n=t.getCanvasId();i.canvasMap[n]=i.canvasMap[n]?i.canvasMap[n]:[],i.canvasMap[n].push(t),t.element.addEventListener("play",(function(){e._onPlay.forEach((function(e){return e(n,t.element.currentTime,t)}))})),t.element.addEventListener("pause",(function(){e._onPause.forEach((function(e){return e(n,t.element.currentTime,t)}))}))},i=this,r=0,a=t;r<a.length;r++){n(a[r])}this.activeElement=t[0]}return t.prototype.syncClock=function(t){this.activeElement.syncClock(t)},t.prototype.onPlay=function(t){this._onPlay.push(t)},t.prototype.onPause=function(t){this._onPause.push(t)},t.prototype.findElementInRange=function(t,e){if(this.canvasMap[t])for(var n=0,i=this.canvasMap[t];n<i.length;n++){var r=i[n];if(r.isWithinRange(e))return r}},t.prototype.appendTo=function(t){console.log("Appending...",this.elements.map((function(t){return t.element}))),t.append(this.elements.map((function(t){return t.element})))},t.prototype.load=function(){return i(this,void 0,void 0,(function(){return r(this,(function(t){switch(t.label){case 0:return[4,Promise.all(this.elements.map((function(t){return t.load()})))];case 1:return t.sent(),[2]}}))}))},t.prototype.seekTo=function(t,e){return i(this,void 0,void 0,(function(){var n;return r(this,(function(i){switch(i.label){case 0:return(n=this.findElementInRange(t,e))&&n!==this.activeElement&&(this.activeElement.stop(),this.activeElement=n),this.playing?[4,this.activeElement.play(e)]:[3,2];case 1:return i.sent(),[3,3];case 2:this.activeElement.syncClock(e),i.label=3;case 3:return[2]}}))}))},t.prototype.play=function(t,e){return i(this,void 0,void 0,(function(){return r(this,(function(n){switch(n.label){case 0:return this.playing=!0,t&&void 0!==e?[4,this.seekTo(t,e)]:[3,2];case 1:n.sent(),n.label=2;case 2:return[2,this.activeElement.play(e)]}}))}))},t.prototype.pause=function(){this.playing=!1,this.activeElement.pause()},t.prototype.setVolume=function(t){for(var e=0,n=this.elements;e<n.length;e++){n[e].element.volume=t}},t.prototype.isBuffering=function(){return this.activeElement.isBuffering()},t}();e.CompositeMediaElement=a},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=function(){function t(t){var e=this;this.length=0,this.duration=0,this.pixelsPerSecond=Number.MAX_VALUE,this.secondsPerPixel=Number.MAX_VALUE,this.timeIndex={},this.minIndex={},this.maxIndex={},this._waveforms=[],t.forEach((function(t){e._waveforms.push({start:e.length,end:e.length+t.adapter.length,waveform:t}),e.length+=t.adapter.length,e.duration+=t.duration,e.pixelsPerSecond=Math.min(e.pixelsPerSecond,t.pixels_per_second),e.secondsPerPixel=Math.min(e.secondsPerPixel,t.seconds_per_pixel)}))}return t.prototype.min=function(t){if(void 0===this.minIndex[t]){var e=this._find(t);this.minIndex[t]=e?e.waveform.min_sample(t-e.start):0}return this.minIndex[t]},t.prototype.max=function(t){if(void 0===this.maxIndex[t]){var e=this._find(t);this.maxIndex[t]=e?e.waveform.max_sample(t-e.start):0}return this.maxIndex[t]},t.prototype._find=function(t){if(void 0===this.timeIndex[t]){var e=this._waveforms.find((function(e){return t>=e.start&&t<e.end}));if(!e)return null;this.timeIndex[t]=e}return this.timeIndex[t]},t}();e.CompositeWaveform=i},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=n(10),r=n(20),a=n(37),o=n(14),s=n(18),u=n(22),l=n(25),c=n(21),h=n(12),p=n(16),f=n(8),d=n(7),v=n(38),_=n(9),g=n(11),m=n(24),y=n(23),E=n(6);e.AVComponentUtils={canPlayHls:i.canPlayHls,createTimePlansFromManifest:r.createTimePlansFromManifest,debounce:a.debounce,diffData:o.diffData,diff:o.diffData,extractMediaFromAnnotationBodies:s.extractMediaFromAnnotationBodies,formatTime:u.formatTime,getFirstTargetedCanvasId:l.getFirstTargetedCanvasId,getMediaSourceFromAnnotationBody:c.getMediaSourceFromAnnotationBody,getSpatialComponent:h.getSpatialComponent,getTimestamp:p.getTimestamp,hlsMimeTypes:f.hlsMimeTypes,hlsMediaTypes:f.hlsMimeTypes,isHLSFormat:d.isHLSFormat,isIE:v.isIE,isMpegDashFormat:_.isMpegDashFormat,isSafari:g.isSafari,isVirtual:m.isVirtual,normalise:y.normalise,normalize:y.normalise,normalizeNumber:y.normalise,normaliseNumber:y.normalise,retargetTemporalComponent:E.retargetTemporalComponent}},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.debounce=function(t,e){return e=e||100,function(){if(!t.debouncing){var n=Array.prototype.slice.apply(arguments);t.lastReturnVal=t.apply(window,n),t.debouncing=!0}return clearTimeout(t.debounceTimeout),t.debounceTimeout=setTimeout((function(){t.debouncing=!1}),e),t.lastReturnVal}}},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.isIE=function(){var t=window.navigator.userAgent,e=t.indexOf("MSIE ");if(e>0)return parseInt(t.substring(e+5,t.indexOf(".",e)),10);if(t.indexOf("Trident/")>0){var n=t.indexOf("rv:");return parseInt(t.substring(n+3,t.indexOf(".",n)),10)}var i=t.indexOf("Edge/");return i>0&&parseInt(t.substring(i+5,t.indexOf(".",i)),10)}}]);